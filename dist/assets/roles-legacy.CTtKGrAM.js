/*! 
 Build based on  
 Time : 1735190558000 */
!function(){function e(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var a=0,u=function(){};return{s:u,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw l}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */n=function(){return t};var e,t={},r=Object.prototype,a=r.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},o=l.iterator||"@@iterator",i=l.asyncIterator||"@@asyncIterator",c=l.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var a=t&&t.prototype instanceof g?t:g,l=Object.create(a.prototype),o=new U(r||[]);return u(l,"_invoke",{value:O(e,n,o)}),l}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var p="suspendedStart",v="suspendedYield",y="executing",m="completed",h={};function g(){}function b(){}function w(){}var k={};s(k,o,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(z([])));x&&x!==r&&a.call(x,o)&&(k=x);var V=w.prototype=g.prototype=Object.create(k);function j(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(r,u,l,o){var i=d(e[r],e,u);if("throw"!==i.type){var c=i.arg,s=c.value;return s&&"object"==typeof s&&a.call(s,"__await")?t.resolve(s.__await).then((function(e){n("next",e,l,o)}),(function(e){n("throw",e,l,o)})):t.resolve(s).then((function(e){c.value=e,l(c)}),(function(e){return n("throw",e,l,o)}))}o(i.arg)}var r;u(this,"_invoke",{value:function(e,a){function u(){return new t((function(t,r){n(e,a,t,r)}))}return r=r?r.then(u,u):u()}})}function O(t,n,r){var a=p;return function(u,l){if(a===y)throw Error("Generator is already running");if(a===m){if("throw"===u)throw l;return{value:e,done:!0}}for(r.method=u,r.arg=l;;){var o=r.delegate;if(o){var i=E(o,r);if(i){if(i===h)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=y;var c=d(t,n,r);if("normal"===c.type){if(a=r.done?m:v,c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}function E(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var u=d(a,t.iterator,n.arg);if("throw"===u.type)return n.method="throw",n.arg=u.arg,n.delegate=null,h;var l=u.arg;return l?l.done?(n[t.resultName]=l.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,h):l:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function G(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function U(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(G,this),this.reset(!0)}function z(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,u=function n(){for(;++r<t.length;)if(a.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return u.next=u}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=w,u(V,"constructor",{value:w,configurable:!0}),u(w,"constructor",{value:b,configurable:!0}),b.displayName=s(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,s(e,c,"GeneratorFunction")),e.prototype=Object.create(V),e},t.awrap=function(e){return{__await:e}},j(C.prototype),s(C.prototype,i,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,a,u){void 0===u&&(u=Promise);var l=new C(f(e,n,r,a),u);return t.isGeneratorFunction(n)?l:l.next().then((function(e){return e.done?e.value:l.next()}))},j(V),s(V,c,"Generator"),s(V,o,(function(){return this})),s(V,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=z,U.prototype={constructor:U,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,a){return o.type="throw",o.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var u=this.tryEntries.length-1;u>=0;--u){var l=this.tryEntries[u],o=l.completion;if("root"===l.tryLoc)return r("end");if(l.tryLoc<=this.prev){var i=a.call(l,"catchLoc"),c=a.call(l,"finallyLoc");if(i&&c){if(this.prev<l.catchLoc)return r(l.catchLoc,!0);if(this.prev<l.finallyLoc)return r(l.finallyLoc)}else if(i){if(this.prev<l.catchLoc)return r(l.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return r(l.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var u=r;break}}u&&("break"===e||"continue"===e)&&u.tryLoc<=t&&t<=u.finallyLoc&&(u=null);var l=u?u.completion:{};return l.type=e,l.arg=t,u?(this.method="next",this.next=u.finallyLoc,h):this.complete(l)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;L(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:z(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),h}},t}function r(e,t,n,r,a,u,l){try{var o=e[u](l),i=o.value}catch(e){return void n(e)}o.done?t(i):Promise.resolve(i).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,u){var l=e.apply(t,n);function o(e){r(l,a,u,o,i,"next",e)}function i(e){r(l,a,u,o,i,"throw",e)}o(void 0)}))}}System.register(["./index-legacy.Cf1_fyJw.js","./tab-pane-legacy.DpVaa-__.js","./form-legacy.0XPxLcB_.js","./tag-legacy.Ca3_ouli.js","./select-legacy.L6EZLrW8.js","./scrollbar-legacy.dKZTD6w2.js","./popper-legacy.BkTYt---.js","./form-item-legacy.BSRxtXpO.js","./input-legacy.DqeBI0DR.js","./dialog-legacy.DSWM2KL1.js","./overlay-legacy.BUxXTiH4.js","./table-column-legacy.BxF_olX2.js","./checkbox-legacy.CC9hZC3z.js","./tooltip-legacy.DJvkFyUq.js","./button-legacy.CH0FoAJ-.js","./age-legacy.B6tOd1kw.js","./k8sCluster-legacy.Bhs3SaAk.js","./index-legacy.DPmmO7_J.js"],(function(t,r){"use strict";var u,l,o,i,c,s,f,d,p,v,y,m,h,g,b,w,k,_,x,V,j,C,O,E,G,L,U,z,T,I,P,A,S,B;return{setters:[function(e){u=e.a,l=e.o,o=e.c,i=e.e,c=e.w,s=e.b,f=e.t,d=e.F,p=e.v,v=e.h,y=e.g,m=e.f,h=e._,g=e.B,b=e.i,w=e.cu,k=e.E,_=e.k},function(e){x=e.E,V=e.a},null,null,function(e){j=e.E,C=e.a},null,null,function(e){O=e.a,E=e.E},null,function(e){G=e.E},null,function(e){L=e.E,U=e.a},null,null,null,function(e){z=e.A},function(e){T=e.c,I=e.u,P=e.d,A=e.a,S=e.b},function(e){B=e.E}],execute:function(){var r=document.createElement("style");r.textContent=".operate-span-primary[data-v-14eb6a2f],.operate-span-primary[data-v-7fa1e4f1]{color:var(--el-color-primary);cursor:pointer;font-weight:700}\n",document.head.appendChild(r);var F={key:0,class:"el-icon-check"},N={key:1},R={key:0,class:"el-icon-check"},D={key:1},M={key:0,class:"el-icon-check"},Y={key:1},W={key:0,class:"el-icon-check"},$={key:1},q={key:0,class:"el-icon-check"},H={key:1},J={key:0,class:"el-icon-check"},K={key:1},Q={key:0,class:"el-icon-check"},X={key:1},Z={name:"Rules"},ee=Object.assign(Z,{props:{form:{default:function(){return{}},type:Object}},setup:function(e){var t=e,n=u({});n.value=t.form;var r=function(e,t){return e.indexOf("*")>-1?e.indexOf("*")>-1:e.indexOf(t)>-1};return function(e,t){var a=L,u=B,h=U;return l(),o("div",null,[i(h,{ref:"multipleTable",data:n.value.rules,style:{width:"100%"},"tooltip-effect":"dark","row-key":"ID"},{default:c((function(){return[i(a,{align:"left",label:"名称",prop:"metadata.name",width:"150"},{default:c((function(e){return[s("span",null,f(n.value.metadata.name),1)]})),_:1}),i(a,{label:"API Groups",width:"150"},{default:c((function(e){return[(l(!0),o(d,null,p(e.row.apiGroups,(function(e,t){return l(),o("div",{key:t},[""!==e?(l(),v(u,{key:0},{default:c((function(){return[y(f(e),1)]})),_:2},1024)):m("",!0)])})),128))]})),_:1}),i(a,{label:"URL"},{default:c((function(e){return[(l(!0),o(d,null,p(e.row.nonResourceURLs,(function(e,t){return l(),o("span",{key:t},f(e),1)})),128))]})),_:1}),i(a,{label:"Resources","min-width":"300px"},{default:c((function(e){return[(l(!0),o(d,null,p(e.row.resources,(function(e,t){return l(),v(u,{key:t,type:"success"},{default:c((function(){return[y(f(e),1)]})),_:2},1024)})),128))]})),_:1}),i(a,{label:"Create",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"create")?(l(),o("i",F,"* ")):(l(),o("span",N," - "))]})),_:1}),i(a,{label:"Delete",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"delete")?(l(),o("i",R,"* ")):(l(),o("span",D," - "))]})),_:1}),i(a,{label:"Get",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"get")?(l(),o("i",M,"* ")):(l(),o("span",Y," - "))]})),_:1}),i(a,{label:"List",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"list")?(l(),o("i",W,"* ")):(l(),o("span",$," - "))]})),_:1}),i(a,{label:"Patch",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"patch")?(l(),o("i",q,"* ")):(l(),o("span",H," - "))]})),_:1}),i(a,{label:"Update",width:"80px"},{default:c((function(e){return[r(e.row.verbs,"update")?(l(),o("i",J,"* ")):(l(),o("span",K," - "))]})),_:1}),i(a,{label:"Watch",width:"80px"},{default:c((function(e){var t=e.row;return[r(t.verbs,"watch")?(l(),o("i",Q,"* ")):(l(),o("span",X," - "))]})),_:1})]})),_:1},8,["data"])])}}}),te={class:"dycloud-btn-list"},ne={key:0,style:{width:"100%"}},re=["onClick"],ae={key:0},ue={key:1},le={key:1},oe={key:2},ie={border:"1",cellspacing:"0",style:{width:"100%"}},ce={align:"left"},se={key:0},fe={style:{"text-align":"center"}},de={class:"dialog-footer",align:"center"},pe={name:"ClusterRoles"},ve=Object.assign(pe,{props:{form:{default:function(){return{}},type:Object}},setup:function(t){var r=t,h=u([]),x=u([]),V=function(){var e=a(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({cluster_id:r.form.id,role_type:"cluster"});case 2:0===(t=e.sent).code&&(x.value=t.data.roles);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=u([]),F=u(0),N=function(){var t=a(n().mark((function t(){var r,a,u,l;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S({cluster_id:F.value,api_type:"cluster"});case 2:if(0===(r=t.sent).code){B.value=r.data.groups,a=e(r.data.groups);try{for(a.s();!(u=a.n()).done;)l=u.value,h.value.push(""===l.group?"core":l.group)}catch(n){a.e(n)}finally{a.f()}}case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();F.value=r.form.id,V(),N();var R=u(!1),D=u({}),M=u(""),Y=u("角色详情"),W=u({}),$=u(!1),q=function(){M.value="create",W.value={name:"",rules:[],description:""},Y.value="创建集群角色",$.value=!0},H=function(){V()},J=u({}),K=function(){W.value={name:"",rules:[],description:""},$.value=!1},Q=function(){var t=a(n().mark((function t(){var r,a,u,l;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={cluster_id:F.value,metadata:{name:W.value.name,annotations:{description:W.value.description},labels:{"devops/role-type":"cluster"}},rules:[]},a=e(W.value.rules);try{for(a.s();!(u=a.n()).done;)l=u.value,r.rules.push({apiGroups:l.apiGroups,resources:l.resources,verbs:l.verbs})}catch(n){a.e(n)}finally{a.f()}t.t0=M.value,t.next="create"===t.t0?6:"edit"===t.t0?12:18;break;case 6:return t.next=8,T(r);case 8:return 0===t.sent.code&&b({type:"success",message:"角色添加成功!"}),$.value=!1,t.abrupt("break",24);case 12:return t.next=14,I(r);case 14:return 0===t.sent.code&&b({type:"success",message:"角色更新成功!"}),$.value=!1,t.abrupt("break",24);case 18:return t.next=20,T(r);case 20:return 0===t.sent.code&&b({type:"success",message:"角色添加成功!"}),$.value=!1,t.abrupt("break",24);case 24:H();case 25:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),X=function(){var e=a(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w.confirm("您确定要删除  "+t.metadata.name+" 角色？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(a(n().mark((function e(){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cluster_id=F.value,e.next=3,P(t);case 3:0===(r=e.sent).code&&b({type:"success",message:r.msg}),V();case 6:case"end":return e.stop()}}),e)})))).catch((function(){b({type:"info",message:"已取消删除!"})}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return function(t,n){var r=k,a=L,u=U,w=G,V=_,T=O,I=j,P=C,A=E;return l(),o("div",null,[s("div",te,[i(r,{size:"small",link:"",type:"primary",icon:"plus",onClick:q},{default:c((function(){return n[6]||(n[6]=[y("添加")])})),_:1}),i(r,{size:"small",link:"",type:"primary",icon:"refresh",onClick:H},{default:c((function(){return n[7]||(n[7]=[y("刷新")])})),_:1})]),x.value?(l(),o("div",ne,[i(u,{ref:"multipleTable",data:x.value,style:{width:"100%"},"tooltip-effect":"dark","row-key":"ID"},{default:c((function(){return[i(a,{align:"left",label:"名称",prop:"metadata.name"},{default:c((function(e){return[s("span",{class:"operate-span-primary",onClick:function(t){return n=e.row,D.value=n,void(R.value=!0);var n}},f(e.row.metadata.name),9,re)]})),_:1}),i(a,{align:"left",label:"内置",prop:"metadata.name"},{default:c((function(e){return["true"===e.row.metadata.annotations.builtin?(l(),o("span",ae,"是")):(l(),o("span",ue,"否"))]})),_:1}),i(a,{align:"left",label:"存活时间",prop:"metadata.creationTimestamp",width:"180"},{default:c((function(e){return[s("span",null,f(g(z)(e.row.metadata.creationTimestamp)),1)]})),_:1}),i(a,{align:"left",label:"操作"},{default:c((function(t){return["false"!==t.row.metadata.annotations.builtin?(l(),v(r,{key:0,size:"small",type:"primary",link:"",icon:"edit",disabled:""},{default:c((function(){return n[8]||(n[8]=[y("编辑")])})),_:1})):(l(),v(r,{key:1,size:"small",type:"primary",link:"",icon:"edit",onClick:function(n){return function(t){M.value="edit",W.value={name:t.metadata.name,description:t.metadata.annotations.description,rules:t.rules};var n,r=e(W.value.rules);try{for(r.s();!(n=r.n()).done;)for(var a=n.value,u=0;u<a.apiGroups.length;u++)""===a.apiGroups[u]&&(a.apiGroups[u]="core")}catch(l){r.e(l)}finally{r.f()}$.value=!0}(t.row)}},{default:c((function(){return n[9]||(n[9]=[y("编辑")])})),_:2},1032,["onClick"])),"false"!==t.row.metadata.annotations.builtin?(l(),v(r,{key:2,type:"primary",link:"",icon:"delete",size:"small",disabled:""},{default:c((function(){return n[10]||(n[10]=[y("删除")])})),_:1})):(l(),v(r,{key:3,type:"primary",link:"",icon:"delete",size:"small",onClick:function(e){return X(t.row)}},{default:c((function(){return n[11]||(n[11]=[y("删除")])})),_:2},1032,["onClick"]))]})),_:1})]})),_:1},8,["data"])])):m("",!0),R.value?(l(),o("div",le,[i(w,{modelValue:R.value,"onUpdate:modelValue":n[0]||(n[0]=function(e){return R.value=e}),width:"70%",title:Y.value,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:c((function(){return[i(ee,{form:D.value},null,8,["form"])]})),_:1},8,["modelValue","title"])])):m("",!0),$.value?(l(),o("div",oe,[i(w,{modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=function(e){return $.value=e}),width:"70%",title:Y.value,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:c((function(){return[i(A,{ref:"FormBlock",model:W.value},{default:c((function(){return[i(T,{label:"名称",prop:"name"},{default:c((function(){return["edit"===M.value?(l(),v(V,{key:0,modelValue:W.value.name,"onUpdate:modelValue":n[1]||(n[1]=function(e){return W.value.name=e}),disabled:"",autocomplete:"off"},null,8,["modelValue"])):(l(),v(V,{key:1,modelValue:W.value.name,"onUpdate:modelValue":n[2]||(n[2]=function(e){return W.value.name=e}),autocomplete:"off"},null,8,["modelValue"]))]})),_:1}),i(T,{label:"描述",prop:"description"},{default:c((function(){return[i(V,{modelValue:W.value.description,"onUpdate:modelValue":n[3]||(n[3]=function(e){return W.value.description=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1}),i(T,{label:"规则",prop:"rules"},{default:c((function(){return[s("table",ie,[n[15]||(n[15]=s("thead",null,[s("tr",null,[s("th",{style:{width:"30%"}},"API 组"),s("th",{style:{width:"30%"}},"资源"),s("th",{style:{width:"30%"}},"动作")])],-1)),s("tbody",null,[s("tr",null,[s("td",ce,[i(r,{size:"small",type:"primary",link:"",icon:"plus",onClick:n[4]||(n[4]=function(n){return function(){var t,n=e(W.value.rules);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(0===r.apiGroups.length||0===r.resources.length||0===r.verbs.length)return void b({type:"error",message:"角色规则不能为空!"})}}catch(a){n.e(a)}finally{n.f()}J.value={apiGroups:[],resources:[],verbs:[]},W.value.rules.push(J.value)}(t.item)})},{default:c((function(){return n[12]||(n[12]=[y("添加")])})),_:1})])]),0===W.value.rules.length?(l(),o("tr",se,n[13]||(n[13]=[s("td",{style:{"text-align":"center"},colspan:"4"},"无数据",-1)]))):m("",!0),(l(!0),o(d,null,p(W.value.rules,(function(t,a){return l(),o("tr",{key:a},[s("td",fe,[i(P,{modelValue:t.apiGroups,"onUpdate:modelValue":function(e){return t.apiGroups=e},filterable:"",style:{width:"90%"},multiple:"",onChange:function(n){return function(t){var n,r=[],a=e(t.apiGroups);try{for(a.s();!(n=a.n()).done;){var u,l=n.value,o="core"===l?"":l,i=e(B.value);try{for(i.s();!(u=i.n()).done;){var c=u.value;if(o===c.group){var s,f=e(c.resources);try{for(f.s();!(s=f.n()).done;){var d=s.value;r.push(d.resource)}}catch(v){f.e(v)}finally{f.f()}}}}catch(v){i.e(v)}finally{i.f()}}}catch(v){a.e(v)}finally{a.f()}var p=new Map;t.resourceOptions=r.filter((function(e){return!p.has(e)&&p.set(e,1)}))}(t)}},{default:c((function(){return[(l(!0),o(d,null,p(h.value,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),s("td",null,[i(P,{modelValue:t.resources,"onUpdate:modelValue":function(e){return t.resources=e},multiple:"",filterable:"",style:{width:"90%"},onChange:function(n){return function(t){var n,r=[],a=e(t.resources);try{for(a.s();!(n=a.n()).done;){var u,l=n.value,o=e(B.value);try{for(o.s();!(u=o.n()).done;){var i,c=e(u.value.resources);try{for(c.s();!(i=c.n()).done;){var s=i.value;l===s.resource&&(r=s.verbs)}}catch(d){c.e(d)}finally{c.f()}}}catch(d){o.e(d)}finally{o.f()}}}catch(d){a.e(d)}finally{a.f()}r.unshift("*");var f=new Map;t.verbOptions=r.filter((function(e){return!f.has(e)&&f.set(e,1)}))}(t)}},{default:c((function(){return[(l(!0),o(d,null,p(t.resourceOptions,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),s("td",null,[i(P,{modelValue:t.verbs,"onUpdate:modelValue":function(e){return t.verbs=e},multiple:"",filterable:"",style:{width:"90%"}},{default:c((function(){return[(l(!0),o(d,null,p(t.verbOptions,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])]),s("td",null,[i(r,{type:"danger",link:"",icon:"delete",size:"small",onClick:function(e){return function(e){var t=W.value.rules.indexOf(e);t>-1&&W.value.rules.splice(t,1)}(t)}},{default:c((function(){return n[14]||(n[14]=[y("删除")])})),_:2},1032,["onClick"])])])})),128))])])]})),_:1}),s("div",de,[i(r,{size:"small",onClick:K},{default:c((function(){return n[16]||(n[16]=[y("取 消")])})),_:1}),i(r,{size:"small",type:"primary",onClick:Q},{default:c((function(){return n[17]||(n[17]=[y("确 定")])})),_:1})])]})),_:1},8,["model"])]})),_:1},8,["modelValue","title"])])):m("",!0)])}}}),ye=h(ve,[["__scopeId","data-v-14eb6a2f"]]),me={class:"dycloud-btn-list"},he={key:0,style:{width:"100%"}},ge=["onClick"],be={key:0},we={key:1},ke={key:1},_e={key:2},xe={border:"1",cellspacing:"0",style:{width:"100%"}},Ve={align:"left"},je={key:0},Ce={style:{"text-align":"center"}},Oe={class:"dialog-footer",align:"center"},Ee={name:"ClusterRoles"},Ge=Object.assign(Ee,{props:{form:{default:function(){return{}},type:Object}},setup:function(t){var r=t,h=u([]),x=u([]),V=function(){var e=a(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({cluster_id:r.form.id,role_type:"namespace"});case 2:0===(t=e.sent).code&&(x.value=t.data.roles);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=u([]),F=u(0),N=function(){var t=a(n().mark((function t(){var r,a,u,l;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S({cluster_id:F.value,api_type:"namespace"});case 2:if(0===(r=t.sent).code){B.value=r.data.groups,a=e(r.data.groups);try{for(a.s();!(u=a.n()).done;)l=u.value,h.value.push(""===l.group?"core":l.group)}catch(n){a.e(n)}finally{a.f()}}case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();F.value=r.form.id,V(),N();var R=u(!1),D=u({}),M=u(""),Y=u("角色详情"),W=u({}),$=u(!1),q=function(){M.value="create",W.value={name:"",rules:[],description:""},Y.value="创建集群角色",$.value=!0},H=function(){V()},J=u({}),K=function(){W.value={name:"",rules:[],description:""},$.value=!1},Q=function(){var t=a(n().mark((function t(){var r,a,u,l;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={cluster_id:F.value,metadata:{name:W.value.name,annotations:{description:W.value.description},labels:{"devops/role-type":"namespace"}},rules:[]},a=e(W.value.rules);try{for(a.s();!(u=a.n()).done;)l=u.value,r.rules.push({apiGroups:l.apiGroups,resources:l.resources,verbs:l.verbs})}catch(n){a.e(n)}finally{a.f()}t.t0=M.value,t.next="create"===t.t0?6:"edit"===t.t0?12:18;break;case 6:return t.next=8,T(r);case 8:return 0===t.sent.code&&b({type:"success",message:"角色添加成功!"}),$.value=!1,t.abrupt("break",24);case 12:return t.next=14,I(r);case 14:return 0===t.sent.code&&b({type:"success",message:"角色更新成功!"}),$.value=!1,t.abrupt("break",24);case 18:return t.next=20,T(r);case 20:return 0===t.sent.code&&b({type:"success",message:"角色添加成功!"}),$.value=!1,t.abrupt("break",24);case 24:H();case 25:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),X=function(){var e=a(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:w.confirm("您确定要删除  "+t.metadata.name+" 角色？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(a(n().mark((function e(){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.cluster_id=F.value,e.next=3,P(t);case 3:0===(r=e.sent).code&&b({type:"success",message:r.msg}),V();case 6:case"end":return e.stop()}}),e)})))).catch((function(){b({type:"info",message:"已取消删除!"})}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return function(t,n){var r=k,a=L,u=U,w=G,V=_,T=O,I=j,P=C,A=E;return l(),o("div",null,[s("div",me,[i(r,{size:"small",link:"",type:"primary",icon:"plus",onClick:q},{default:c((function(){return n[6]||(n[6]=[y("添加")])})),_:1}),i(r,{size:"small",link:"",type:"primary",icon:"refresh",onClick:H},{default:c((function(){return n[7]||(n[7]=[y("刷新")])})),_:1})]),x.value?(l(),o("div",he,[i(u,{ref:"multipleTable",data:x.value,style:{width:"100%"},"tooltip-effect":"dark","row-key":"ID"},{default:c((function(){return[i(a,{align:"left",label:"名称",prop:"metadata.name"},{default:c((function(e){return[s("span",{class:"operate-span-primary",onClick:function(t){return n=e.row,D.value=n,void(R.value=!0);var n}},f(e.row.metadata.name),9,ge)]})),_:1}),i(a,{align:"left",label:"内置",prop:"metadata.name"},{default:c((function(e){return["true"===e.row.metadata.annotations.builtin?(l(),o("span",be,"是")):(l(),o("span",we,"否"))]})),_:1}),i(a,{align:"left",label:"存活时间",prop:"metadata.creationTimestamp",width:"180"},{default:c((function(e){return[s("span",null,f(g(z)(e.row.metadata.creationTimestamp)),1)]})),_:1}),i(a,{align:"left",label:"操作"},{default:c((function(t){return["false"!==t.row.metadata.annotations.builtin?(l(),v(r,{key:0,size:"small",type:"primary",link:"",icon:"edit",disabled:""},{default:c((function(){return n[8]||(n[8]=[y("编辑")])})),_:1})):(l(),v(r,{key:1,size:"small",type:"primary",link:"",icon:"edit",onClick:function(n){return function(t){M.value="edit",W.value={name:t.metadata.name,description:t.metadata.annotations.description,rules:t.rules};var n,r=e(W.value.rules);try{for(r.s();!(n=r.n()).done;)for(var a=n.value,u=0;u<a.apiGroups.length;u++)""===a.apiGroups[u]&&(a.apiGroups[u]="core")}catch(l){r.e(l)}finally{r.f()}$.value=!0}(t.row)}},{default:c((function(){return n[9]||(n[9]=[y("编辑")])})),_:2},1032,["onClick"])),"false"!==t.row.metadata.annotations.builtin?(l(),v(r,{key:2,type:"primary",link:"",icon:"delete",size:"small",disabled:""},{default:c((function(){return n[10]||(n[10]=[y("删除")])})),_:1})):(l(),v(r,{key:3,type:"primary",link:"",icon:"delete",size:"small",onClick:function(e){return X(t.row)}},{default:c((function(){return n[11]||(n[11]=[y("删除")])})),_:2},1032,["onClick"]))]})),_:1})]})),_:1},8,["data"])])):m("",!0),R.value?(l(),o("div",ke,[i(w,{modelValue:R.value,"onUpdate:modelValue":n[0]||(n[0]=function(e){return R.value=e}),width:"70%",title:Y.value,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:c((function(){return[i(ee,{form:D.value},null,8,["form"])]})),_:1},8,["modelValue","title"])])):m("",!0),$.value?(l(),o("div",_e,[i(w,{modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=function(e){return $.value=e}),width:"70%",title:Y.value,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:c((function(){return[i(A,{ref:"FormBlock",model:W.value},{default:c((function(){return[i(T,{label:"名称",prop:"name"},{default:c((function(){return["edit"===M.value?(l(),v(V,{key:0,modelValue:W.value.name,"onUpdate:modelValue":n[1]||(n[1]=function(e){return W.value.name=e}),disabled:"",autocomplete:"off"},null,8,["modelValue"])):(l(),v(V,{key:1,modelValue:W.value.name,"onUpdate:modelValue":n[2]||(n[2]=function(e){return W.value.name=e}),autocomplete:"off"},null,8,["modelValue"]))]})),_:1}),i(T,{label:"描述",prop:"description"},{default:c((function(){return[i(V,{modelValue:W.value.description,"onUpdate:modelValue":n[3]||(n[3]=function(e){return W.value.description=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1}),i(T,{label:"规则",prop:"rules"},{default:c((function(){return[s("table",xe,[n[15]||(n[15]=s("thead",null,[s("tr",null,[s("th",{style:{width:"30%"}},"API 组"),s("th",{style:{width:"30%"}},"资源"),s("th",{style:{width:"30%"}},"动作")])],-1)),s("tbody",null,[s("tr",null,[s("td",Ve,[i(r,{size:"small",type:"primary",link:"",icon:"plus",onClick:n[4]||(n[4]=function(n){return function(){var t,n=e(W.value.rules);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(0===r.apiGroups.length||0===r.resources.length||0===r.verbs.length)return void b({type:"error",message:"角色规则不能为空!"})}}catch(a){n.e(a)}finally{n.f()}J.value={apiGroups:[],resources:[],verbs:[]},W.value.rules.push(J.value)}(t.item)})},{default:c((function(){return n[12]||(n[12]=[y("添加")])})),_:1})])]),0===W.value.rules.length?(l(),o("tr",je,n[13]||(n[13]=[s("td",{style:{"text-align":"center"},colspan:"4"},"无数据",-1)]))):m("",!0),(l(!0),o(d,null,p(W.value.rules,(function(t,a){return l(),o("tr",{key:a},[s("td",Ce,[i(P,{modelValue:t.apiGroups,"onUpdate:modelValue":function(e){return t.apiGroups=e},filterable:"",style:{width:"90%"},multiple:"",onChange:function(n){return function(t){var n,r=[],a=e(t.apiGroups);try{for(a.s();!(n=a.n()).done;){var u,l=n.value,o="core"===l?"":l,i=e(B.value);try{for(i.s();!(u=i.n()).done;){var c=u.value;if(o===c.group){var s,f=e(c.resources);try{for(f.s();!(s=f.n()).done;){var d=s.value;r.push(d.resource)}}catch(v){f.e(v)}finally{f.f()}}}}catch(v){i.e(v)}finally{i.f()}}}catch(v){a.e(v)}finally{a.f()}var p=new Map;t.resourceOptions=r.filter((function(e){return!p.has(e)&&p.set(e,1)}))}(t)}},{default:c((function(){return[(l(!0),o(d,null,p(h.value,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),s("td",null,[i(P,{modelValue:t.resources,"onUpdate:modelValue":function(e){return t.resources=e},multiple:"",filterable:"",style:{width:"90%"},onChange:function(n){return function(t){var n,r=[],a=e(t.resources);try{for(a.s();!(n=a.n()).done;){var u,l=n.value,o=e(B.value);try{for(o.s();!(u=o.n()).done;){var i,c=e(u.value.resources);try{for(c.s();!(i=c.n()).done;){var s=i.value;l===s.resource&&(r=s.verbs)}}catch(d){c.e(d)}finally{c.f()}}}catch(d){o.e(d)}finally{o.f()}}}catch(d){a.e(d)}finally{a.f()}r.unshift("*");var f=new Map;t.verbOptions=r.filter((function(e){return!f.has(e)&&f.set(e,1)}))}(t)}},{default:c((function(){return[(l(!0),o(d,null,p(t.resourceOptions,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),s("td",null,[i(P,{modelValue:t.verbs,"onUpdate:modelValue":function(e){return t.verbs=e},multiple:"",filterable:"",style:{width:"90%"}},{default:c((function(){return[(l(!0),o(d,null,p(t.verbOptions,(function(e,t){return l(),v(I,{key:t,value:e},{default:c((function(){return[y(f(e),1)]})),_:2},1032,["value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])]),s("td",null,[i(r,{type:"danger",link:"",icon:"delete",size:"small",onClick:function(e){return function(e){var t=W.value.rules.indexOf(e);t>-1&&W.value.rules.splice(t,1)}(t)}},{default:c((function(){return n[14]||(n[14]=[y("删除")])})),_:2},1032,["onClick"])])])})),128))])])]})),_:1}),s("div",Oe,[i(r,{size:"small",onClick:K},{default:c((function(){return n[16]||(n[16]=[y("取 消")])})),_:1}),i(r,{size:"small",type:"primary",onClick:Q},{default:c((function(){return n[17]||(n[17]=[y("确 定")])})),_:1})])]})),_:1},8,["model"])]})),_:1},8,["modelValue","title"])])):m("",!0)])}}}),Le=h(Ge,[["__scopeId","data-v-7fa1e4f1"]]),Ue={name:"RulesBlock"};t("_",Object.assign(Ue,{props:{form:{default:function(){return{}},type:Object}},setup:function(e){var t=u("left"),n=e,r=u({});return r.value=n.form,function(e,n){var a=x,u=V;return l(),o("div",null,[i(u,{"tab-position":t.value,style:{height:"100%"}},{default:c((function(){return[i(a,{label:"集群"},{default:c((function(){return[i(ye,{form:r.value},null,8,["form"])]})),_:1}),i(a,{label:"命名空间"},{default:c((function(){return[i(Le,{form:r.value},null,8,["form"])]})),_:1})]})),_:1},8,["tab-position"])])}}}))}}}))}();
