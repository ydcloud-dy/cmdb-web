/*! 
 Build based on  
 Time : 1735190558000 */
import{s as e,a,R as t,o as s,c as o,b as l,e as r,w as i,g as p,t as n,i as d,k as u,E as c}from"./index.ABWJOL2Q.js";import{E as h}from"./scrollbar.3ySweVnY.js";/* empty css             */import"./checkbox.BcMUmSPv.js";/* empty css                *//* empty css               *//* empty css               *//* empty css              */import{j as m}from"./api.CmojoYCN.js";import{E as f}from"./index.D4uEcQv3.js";import{E as v}from"./index.HOewoZCo.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.BRjlB3m5.js";import"./token.DWNpOE8r.js";import"./index.gYVODlrW.js";const y={class:"sticky top-0.5 z-10 flex space-x-2"},j={class:"tree-content"},x={class:"flex items-center justify-between w-full pr-1"},b={class:"max-w-[240px] break-all overflow-ellipsis overflow-hidden"},k=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(k,{expose:w}){const g=k,I=a({children:"children",label:"description"}),E=a(""),_=a(""),V=a([]),C=a([]),O=a("");(async()=>{const a=(await m()).data.apis;V.value=P(a);const t=await(s={authorityId:g.row.authorityId},e({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;O.value=g.row.authorityId,C.value=[],t.data.paths&&t.data.paths.forEach((e=>{C.value.push("p:"+e.path+"m:"+e.method)}))})();const A=a(!1),G=()=>{A.value=!0},P=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},U=a(null),N=async()=>{const a=U.value.getCheckedNodes(!0);var t=[];a&&a.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var s;0===(await(s={authorityId:O.value,casbinInfos:t},e({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&d({type:"success",message:"api设置成功"})};w({needConfirm:A,enterAndNext:()=>{N()}});const q=(e,a)=>{if(!E.value&&!_.value)return!0;let t,s;return t=!E.value||a.description&&a.description.includes(E.value),s=!_.value||a.path&&a.path.includes(_.value),t&&s};return t([E,_],(()=>{U.value.filter("")})),(e,a)=>{const t=u,d=c,m=f,k=v,w=h;return s(),o("div",null,[l("div",y,[r(t,{modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),class:"flex-1",placeholder:"筛选名字"},null,8,["modelValue"]),r(t,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),class:"flex-1",placeholder:"筛选路径"},null,8,["modelValue"]),r(d,{class:"float-right",type:"primary",onClick:N},{default:i((()=>a[2]||(a[2]=[p("确 定")]))),_:1})]),l("div",j,[r(w,null,{default:i((()=>[r(k,{ref_key:"apiTree",ref:U,data:V.value,"default-checked-keys":C.value,props:I.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":q,onCheck:G},{default:i((({node:e,data:a})=>[l("div",x,[l("span",null,n(a.description),1),r(m,{content:a.path},{default:i((()=>[l("span",b,n(a.path),1)])),_:2},1032,["content"])])])),_:1},8,["data","default-checked-keys","props"])])),_:1})])])}}});export{k as default};
