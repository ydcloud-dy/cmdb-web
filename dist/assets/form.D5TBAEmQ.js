/*! 
 Build based on  
 Time : 1735190558000 */
import{R as e,a,o as l,c as t,e as n,w as s,F as o,v as u,h as r,b as i,g as m,f as d,E as p,k as c,t as v}from"./index.ABWJOL2Q.js";import{E as f}from"./card.RgDT494R.js";/* empty css               *//* empty css             */import{E as y,a as b}from"./tab-pane.fs024GHS.js";import{E as k,a as h}from"./col.BzMVCOvM.js";import{a as g,E as _}from"./form-item.ujPiwBAF.js";import{_ as V}from"./index.B0d1JK95.js";import{_ as j,a as x}from"./key-value.C1obDZCo.js";/* empty css            */import{E as C,a as U}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              */import{S as w}from"./services.B6UNrciu.js";import{S as z}from"./secrets.hDCpAdRW.js";import"./strings.C2tuonvC.js";import"./index.C5gbd99D.js";import"./castArray.9wqFpW2Z.js";import"./_baseClone.gl1e0kmI.js";import"./_Uint8Array.BjvNwsUf.js";import"./_initCloneObject.jmqS1x-g.js";/* empty css                    *//* empty css              *//* empty css                       */import"./checkbox.BcMUmSPv.js";import"./isEqual.CtpQH3Dm.js";import"./index.DINKPDpR.js";import"./namespaces.DIn9v7pI.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";const N={style:{"margin-top":"20px"}},S={style:{float:"right",padding:"3px 0",position:"relative","z-index":"1"}},E={style:{width:"100%",padding:"0"},class:"tab-table"},P={key:0},T={key:1},O={key:2},I={key:3},q={align:"left"},B={name:"IngressRule"},F=Object.assign(B,{props:{form:{default:function(){return{}},type:Object},cluster:{default:function(){return 0},type:Number},version:{default:function(){return""},type:String},namespace:{default:function(){return""},type:String}},setup(v){const y=v;e((()=>y.namespace),(async()=>{await V(y.namespace)}));const b=a([]),V=async e=>{const a=await w({cluster_id:z.value,namespace:e});0===a.code&&(b.value=a.data.items)},j=a(""),x=a(!1),z=a(0),B=a("");(async()=>{j.value=y.form,z.value=y.cluster,B.value=y.namespace,"networking.k8s.io/v1"===y.version&&(x.value=!0),await V(B.value)})();const F=()=>{j.value.spec.rules&&j.value.spec.rules.push(x?{host:"",http:{paths:[{path:"/",pathType:"Prefix",backend:{service:{name:null,port:{number:null}}}}]}}:{host:"",http:{paths:[{path:"/",pathType:"Prefix",backend:{serviceName:null,servicePort:null}}]}})},R=a([]),A=e=>{for(const a of b.value)if(a.metadata.name===e){R.value=a.spec.ports;break}},H=e=>{e.http.paths.push(x?{path:"/",pathType:"Prefix",backend:{service:{name:null,port:{number:null}}}}:{path:"/",pathType:"Prefix",backend:{serviceName:null,servicePort:null}})};return(e,a)=>{const v=p,y=c,V=g,w=k,z=h,B=C,D=U,G=f,K=_;return l(),t("div",N,[n(G,{class:"box-card",shadow:"hover"},{default:s((()=>[n(K,{ref:"form","label-position":"top",model:j.value},{default:s((()=>[(l(!0),t(o,null,u(j.value.spec.rules,((e,p)=>(l(),r(G,{key:p,style:{"margin-top":"10px",position:"relative"}},{default:s((()=>[i("div",S,[j.value.spec.rules.length>1?(l(),r(v,{key:0,type:"danger",link:"",icon:"delete",size:"small",onClick:e=>{return a=p,void j.value.spec.rules.splice(a,1);var a}},{default:s((()=>a[0]||(a[0]=[m("删除 ")]))),_:2},1032,["onClick"])):d("",!0)]),i("div",null,[n(z,{gutter:20},{default:s((()=>[n(w,{span:12},{default:s((()=>[n(V,{label:"域名",prop:"host"},{default:s((()=>[n(y,{modelValue:e.host,"onUpdate:modelValue":a=>e.host=a,placeholder:"e.g. example.com"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1024),n(z,{gutter:20},{default:s((()=>[n(w,{span:24},{default:s((()=>[i("table",E,[a[3]||(a[3]=i("tr",null,[i("th",{scope:"col",width:"20%",align:"left"},[i("label",null,"路径")]),i("th",{scope:"col",width:"38.5%",align:"left"}),i("th",{scope:"col",width:"20%",align:"left"},[i("label",null,"Service")]),i("th",{scope:"col",width:"20%",align:"left"},[i("label",null,"端口")]),i("th")],-1)),(l(!0),t(o,null,u(e.http.paths,((e,d)=>(l(),t("tr",{key:d},[i("td",null,[n(D,{modelValue:e.pathType,"onUpdate:modelValue":a=>e.pathType=a},{default:s((()=>[n(B,{label:"Prefix",value:"Prefix"}),n(B,{label:"Exact",value:"Exact"}),n(B,{label:"ImplementationSpecific",value:"ImplementationSpecific"})])),_:2},1032,["modelValue","onUpdate:modelValue"])]),i("td",null,[n(y,{modelValue:e.path,"onUpdate:modelValue":a=>e.path=a},null,8,["modelValue","onUpdate:modelValue"])]),x.value?(l(),t("td",T,[n(D,{modelValue:e.backend.service.name,"onUpdate:modelValue":a=>e.backend.service.name=a,style:{width:"100%"},"remove-tag":A(e.backend.service.name),onChange:a=>A(e.backend.service.name)},{default:s((()=>[(l(!0),t(o,null,u(b.value,(e=>(l(),r(B,{key:e.metadata.name,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","remove-tag","onChange"])])):(l(),t("td",P,[n(D,{modelValue:e.backend.serviceName,"onUpdate:modelValue":a=>e.backend.serviceName=a,style:{width:"100%"},"remove-tag":A(e.backend.service.name),onChange:a=>A(e.backend.serviceName)},{default:s((()=>[(l(!0),t(o,null,u(b.value,(e=>(l(),r(B,{key:e.metadata.name,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","remove-tag","onChange"])])),x.value?(l(),t("td",I,[n(D,{modelValue:e.backend.service.port.number,"onUpdate:modelValue":a=>e.backend.service.port.number=a},{default:s((()=>[(l(!0),t(o,null,u(R.value,(e=>(l(),r(B,{key:e.name,label:e.port,value:e.port},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])):(l(),t("td",O,[n(D,{modelValue:e.backend.servicePort,"onUpdate:modelValue":a=>e.backend.servicePort=a},{default:s((()=>[(l(!0),t(o,null,u(R.value,(e=>(l(),r(B,{key:e.name,label:e.port,value:e.port},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),i("td",null,[n(v,{type:"danger",link:"",icon:"delete",size:"small",onClick:e=>((e,a)=>{j.value.spec.rules[e].http.paths.splice(a,1)})(p,d)},{default:s((()=>a[1]||(a[1]=[m(" 删除 ")]))),_:2},1032,["onClick"])])])))),128)),i("tr",null,[i("td",q,[n(v,{size:"small",type:"primary",link:"",icon:"plus",onClick:a=>H(e)},{default:s((()=>a[2]||(a[2]=[m("添加路径 ")]))),_:2},1032,["onClick"])])])])])),_:2},1024)])),_:2},1024)])])),_:2},1024)))),128))])),_:1},8,["model"]),n(v,{size:"small",type:"primary",link:"",icon:"plus",onClick:F},{default:s((()=>a[4]||(a[4]=[m("添加规则 ")]))),_:1})])),_:1})])}}}),R={style:{"margin-top":"20px"}},A={style:{float:"right",padding:"3px 0",position:"relative","z-index":"1"}},H={style:{"margin-top":"20px"}},D={style:{"margin-top":"10px"}},G={name:"IngressTls"},K=Object.assign(G,{props:{form:{default:function(){return{}},type:Object},cluster:{default:function(){return 0},type:Number},namespace:{default:function(){return""},type:String}},setup(v){const y=v;e((()=>y.namespace),(async()=>{x.value=y.namespace,await b()}));const b=async()=>{const e=await z({cluster_id:j.value,namespace:x.value});0===e.code&&(w.value=e.data.items)},V=a(""),j=a(0),x=a(""),w=a([]);(async()=>{V.value=y.form,j.value=y.cluster,x.value=y.namespace,V.value.spec.tls||(V.value.spec.tls=[]),await b()})();const N=()=>{V.value.spec.tls.push({secretName:"",hosts:[]})};return(e,a)=>{const v=p,y=C,b=U,j=g,x=k,z=h,S=c,E=f,P=_;return l(),t("div",R,[n(E,null,{default:s((()=>[n(P,{ref:"form","label-position":"top",model:V.value},{default:s((()=>[(l(!0),t(o,null,u(V.value.spec.tls,((e,p)=>(l(),r(E,{key:p,style:{"margin-top":"10px",position:"relative"}},{default:s((()=>[i("div",A,[V.value.spec.tls.length>1?(l(),r(v,{key:0,type:"danger",link:"",icon:"delete",size:"small",onClick:e=>{return a=p,void V.value.spec.tls.splice(a,1);var a}},{default:s((()=>a[0]||(a[0]=[m("删除 ")]))),_:2},1032,["onClick"])):d("",!0)]),i("div",H,[n(z,{gutter:24},{default:s((()=>[n(x,{span:24},{default:s((()=>[n(j,{label:"证书- Secret Name"},{default:s((()=>[n(b,{modelValue:e.secretName,"onUpdate:modelValue":a=>e.secretName=a,style:{width:"100%"}},{default:s((()=>[n(y,{label:"Default Ingress Controller Certificate",value:""}),(l(!0),t(o,null,u(w.value,((e,a)=>(l(),r(y,{key:a,label:e.metadata.name,value:e.metadata.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1024),n(x,{span:24},{default:s((()=>[n(j,{label:"Host"},{default:s((()=>[(l(!0),t(o,null,u(e.hosts,((o,u)=>(l(),t("div",{key:u},[n(v,{type:"danger",link:"",icon:"delete",size:"small",onClick:a=>((e,a)=>{e.hosts.splice(a,1)})(e,u)},{default:s((()=>a[1]||(a[1]=[m("删除")]))),_:2},1032,["onClick"]),n(x,{span:20},{default:s((()=>[d("",!0),n(S,{modelValue:e.hosts[u],"onUpdate:modelValue":a=>e.hosts[u]=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])))),128)),n(v,{size:"small",type:"primary",link:"",icon:"plus",onClick:a=>(e=>{e.hosts.push("")})(e)},{default:s((()=>a[2]||(a[2]=[m("添加Host")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])])),_:2},1024)))),128))])),_:1},8,["model"]),i("div",D,[n(v,{size:"small",type:"primary",link:"",icon:"plus",onClick:N},{default:s((()=>a[3]||(a[3]=[m("添加证书")]))),_:1})])])),_:1})])}}}),L={class:"grid-content bg-purple-light"},W={style:{float:"right","margin-top":"10px"}},J={name:"FormBlock"},M=Object.assign(J,{props:{form:{default:function(){return{}},type:Object},version:{default:function(){return""},type:String},cluster:{default:function(){return 0},type:Number},readonly:{default:function(){return!1},type:Boolean}},emits:["close","enter"],setup(e,{emit:o}){const u=o,d=e,c=a({}),v=a({}),C=a("rule"),U=a(""),w=a(!1),z=a({"metadata.name":[{required:!0,message:"请输入名称",trigger:"blur"}],"metadata.namespace":[{required:!0,message:"请选择命名空间",trigger:"blur"}]});c.value=d.form,v.value=d.cluster,U.value=d.version,w.value=d.readonly;const N=async e=>{c.value.metadata&&(c.value.metadata.namespace=e)},S=a(null),E=()=>{S.value.resetFields(),u("close")},P=a(null),T=a(null),O=async()=>{await P.value.transformationformat(c.value,"labels"),await T.value.transformationformat(c.value,"annotations"),u("enter",c.value)},I=e=>{C.value=e.name};return(e,a)=>{const o=g,u=k,d=h,q=y,B=b,R=_,A=p,H=f;return l(),t("div",null,[n(H,{class:"el-card"},{default:s((()=>[n(R,{ref_key:"FormBlock",ref:S,model:c.value,rules:z.value,"label-width":"100px"},{default:s((()=>[n(d,{gutter:24},{default:s((()=>[n(u,{span:8},{default:s((()=>[n(o,{label:"名称",prop:"metadata.name"},{default:s((()=>[w.value?(l(),r(V,{key:0,modelValue:c.value.metadata.name,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value.metadata.name=e),style:{width:"100%"},disabled:"","item-type":"input"},null,8,["modelValue"])):(l(),r(V,{key:1,modelValue:c.value.metadata.name,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.metadata.name=e),placeholder:"请输入名称","item-type":"input",style:{width:"100%"}},null,8,["modelValue"]))])),_:1})])),_:1}),n(u,{span:8},{default:s((()=>[n(o,{label:"命名空间",required:"",prop:"metadata.namespace"},{default:s((()=>[w.value?(l(),r(V,{key:0,modelValue:c.value.metadata.namespace,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value.metadata.namespace=e),style:{width:"100%"},disabled:"","item-type":"select2"},null,8,["modelValue"])):(l(),r(j,{key:1,cluster:v.value,namespace:c.value.metadata.namespace,onEnter:N},null,8,["cluster","namespace"]))])),_:1})])),_:1})])),_:1}),n(u,{span:24},{default:s((()=>[n(B,{ref:"tabs",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=e=>C.value=e),"tab-position":"top",type:"border-card",onTabClick:I},{default:s((()=>[n(q,{label:"规则",name:"rule"},{default:s((()=>[n(F,{cluster:v.value,version:U.value,form:c.value,namespace:c.value.metadata.namespace},null,8,["cluster","version","form","namespace"])])),_:1}),n(q,{label:"证书",name:"tls"},{default:s((()=>[n(K,{cluster:v.value,form:c.value,namespace:c.value.metadata.namespace},null,8,["cluster","form","namespace"])])),_:1}),n(q,{name:"Labels",label:"标签/注解"},{default:s((()=>[n(x,{ref_key:"labels",ref:P,title:"标签",form:c.value.metadata.labels},null,8,["form"]),n(x,{ref_key:"annotations",ref:T,title:"注解",form:c.value.metadata.annotations},null,8,["form"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),i("div",L,[i("div",W,[n(A,{size:"small",onClick:E},{default:s((()=>a[4]||(a[4]=[m("取 消")]))),_:1}),n(A,{size:"small",type:"primary",onClick:O},{default:s((()=>a[5]||(a[5]=[m("确 定")]))),_:1})])])])),_:1})])}}});export{M as default};
