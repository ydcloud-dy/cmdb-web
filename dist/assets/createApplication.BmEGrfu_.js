/*! 
 Build based on  
 Time : 1735190558000 */
import{_ as e,a,u as l,q as r,o,c as u,b as t,e as n,w as i,g as s,F as d,v as m,h as p,f as c,x as v,i as f,k as b,E as g}from"./index.ABWJOL2Q.js";/* empty css               */import{E as y}from"./card.RgDT494R.js";/* empty css            */import{E as _,a as h}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css             */import{a as k,E as V}from"./form-item.ujPiwBAF.js";/* empty css              */import{E as j,a as w}from"./step.Cyb8VDAP.js";import{E as x,a as N}from"./breadcrumb-item.DBo9yA-L.js";import{g as U}from"./environment.Z24KwZWA.js";import{g as C}from"./k8sCluster.LvLN1W31.js";import{c as q}from"./applications.GrMV9Sfs.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./index.C5gbd99D.js";const I={style:{margin:"20px"}},E={class:"create-application-container"},D={class:"form-container"},z={key:0},A={class:"button-group"},F={key:1},R={class:"environment-list"},S={class:"button-group"},K=e({__name:"createApplication",setup(e){const K=a(1),L=a(null),G=a(null),J=a([]),O=a([]),P=a({repo:"",branch:"",name:"",identifier:"",description:""}),B=a({owner:[],developers:[],language:"",isCore:!1}),H={repo:[{required:!0,message:"代码仓库不能为空",trigger:"blur"}],branch:[{required:!0,message:"主干分支不能为空",trigger:"blur"}],name:[{required:!0,message:"应用名称不能为空",trigger:"blur"}],identifier:[{required:!0,message:"应用标识不能为空",trigger:"blur"}]},M={owner:[{required:!0,message:"负责人不能为空",trigger:"blur"}],developers:[{required:!0,message:"开发者不能为空",trigger:"change"}],language:[{required:!0,message:"请选择程序设计语言",trigger:"change"}]},Q=a([]),T=l(),W=()=>{T.back()};r((()=>{(async()=>{const e=await v({page:1,pageSize:100});0===e.code&&(Q.value=e.data.list)})(),X(),Y()}));const X=async()=>{const e=await U({page:1,pageSize:1e3});0===e.code&&(J.value=e.data.list.map((e=>({value:e.key,label:e.name}))))},Y=async()=>{const e=await C({page:1,pageSize:1e3});0===e.code&&(O.value=e.data.list.map((e=>({value:e.id,label:e.name}))))},Z=()=>{L.value.validate((e=>{e&&G.value.validate((e=>{e&&(K.value=2)}))}))},$=()=>{K.value=1},ee=async()=>{let e=!0;if(ae.value.forEach(((a,l)=>{a.environment&&a.cluster&&a.namespace||(e=!1,f.error("第 ".concat(l+1," 行存在未填写完整的环境、集群或命名空间")))})),!e)return;const a={envs:ae.value.map((e=>{const a=J.value.find((a=>a.value===e.environment)),l=O.value.find((a=>a.value===e.cluster));return{clusterName:l?l.label:"",clusterId:l?l.value:"",envCode:e.environment,envName:a?a.label:"",namespace:e.namespace}})),app:{gitRepo:P.value.repo,branch:P.value.branch,appName:P.value.name,appCode:P.value.identifier,appDesc:P.value.description,develop:B.value.developers.map((e=>{const a=Q.value.find((a=>a.ID===e));return{label:a?a.nickName:e,value:a?a.userName:e,key:a?a.nickName:e,option:a?{avatar:"",nickname:a.nickName,username:a.userName}:{},originLabel:a?a.nickName:e}})),owner:B.value.owner.map((e=>{const a=Q.value.find((a=>a.ID===e));return{label:a?a.nickName:e,value:a?a.userName:e,key:a?a.nickName:e,option:a?{avatar:"",nickname:a.nickName,username:a.userName}:{},originLabel:a?a.nickName:e}})),language:B.value.language}};try{const e=await q(a);0===e.code?(f.success("应用创建成功！"),T.back()):f.error(e.msg||"应用创建失败！")}catch(l){f.error("应用创建请求失败，请稍后重试！")}},ae=a([]),le=()=>{ae.value.push({environment:"",cluster:"",namespace:""})};return(e,a)=>{const l=x,r=N,v=j,f=w,U=b,C=k,q=V,T=_,X=h,Y=y,re=g;return o(),u(d,null,[t("div",I,[n(r,{separator:"/"},{default:i((()=>[n(l,{href:"/"},{default:i((()=>a[8]||(a[8]=[s("首页")]))),_:1}),n(l,null,{default:i((()=>a[9]||(a[9]=[s("应用发布")]))),_:1}),n(l,null,{default:i((()=>a[10]||(a[10]=[s("创建应用")]))),_:1})])),_:1})]),t("div",E,[t("div",D,[a[20]||(a[20]=t("h2",{style:{color:"white"}},"创建应用",-1)),n(f,{active:K.value,"align-center":""},{default:i((()=>[n(v,{title:"填写应用信息"}),n(v,{title:"关联环境"}),n(v,{title:"完成"})])),_:1},8,["active"]),1===K.value?(o(),u("div",z,[n(Y,{shadow:"always",class:"form-card"},{default:i((()=>[a[11]||(a[11]=t("h3",null,"基本信息",-1)),n(q,{ref_key:"basicInfoFormRef",ref:L,model:P.value,rules:H,"label-width":"120px"},{default:i((()=>[n(C,{label:"代码仓库",prop:"repo"},{default:i((()=>[n(U,{modelValue:P.value.repo,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.repo=e),placeholder:"请输入代码仓库地址"},null,8,["modelValue"])])),_:1}),n(C,{label:"主干分支",prop:"branch"},{default:i((()=>[n(U,{modelValue:P.value.branch,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.branch=e),placeholder:"请输入主干分支"},null,8,["modelValue"])])),_:1}),n(C,{label:"应用名称",prop:"name"},{default:i((()=>[n(U,{modelValue:P.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.name=e),placeholder:"请输入应用名称"},null,8,["modelValue"])])),_:1}),n(C,{label:"应用标识",prop:"identifier"},{default:i((()=>[n(U,{modelValue:P.value.identifier,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.identifier=e),placeholder:"请输入应用标识"},null,8,["modelValue"])])),_:1}),n(C,{label:"应用描述"},{default:i((()=>[n(U,{modelValue:P.value.description,"onUpdate:modelValue":a[4]||(a[4]=e=>P.value.description=e),type:"textarea",maxlength:100,"show-word-limit":"",placeholder:"请输入应用描述"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),a[12]||(a[12]=t("h3",null,"研发信息",-1)),n(q,{ref_key:"developmentFormRef",ref:G,model:B.value,rules:M,"label-width":"120px"},{default:i((()=>[n(C,{label:"负责人",prop:"owner"},{default:i((()=>[n(X,{modelValue:B.value.owner,"onUpdate:modelValue":a[5]||(a[5]=e=>B.value.owner=e),placeholder:"请选择负责人",clearable:"",multiple:""},{default:i((()=>[(o(!0),u(d,null,m(Q.value,(e=>(o(),p(T,{key:e.ID,label:"".concat(e.userName," / ").concat(e.nickName),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"开发",prop:"developers"},{default:i((()=>[n(X,{modelValue:B.value.developers,"onUpdate:modelValue":a[6]||(a[6]=e=>B.value.developers=e),multiple:"",placeholder:"请选择开发人员",clearable:""},{default:i((()=>[(o(!0),u(d,null,m(Q.value,(e=>(o(),p(T,{key:e.ID,label:"".concat(e.userName," / ").concat(e.nickName),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(C,{label:"程序设计语言",prop:"language"},{default:i((()=>[n(X,{modelValue:B.value.language,"onUpdate:modelValue":a[7]||(a[7]=e=>B.value.language=e),placeholder:"请选择程序设计语言"},{default:i((()=>[n(T,{label:"Java",value:"java"}),n(T,{label:"Golang",value:"golang"}),n(T,{label:"Python",value:"python"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1}),t("div",A,[n(re,{type:"default",onClick:W},{default:i((()=>a[13]||(a[13]=[s("返回")]))),_:1}),n(re,{type:"primary",onClick:Z},{default:i((()=>a[14]||(a[14]=[s("下一步")]))),_:1})])])):c("",!0),2===K.value?(o(),u("div",F,[n(Y,{shadow:"always",class:"form-card"},{default:i((()=>[t("div",R,[(o(!0),u(d,null,m(ae.value,((e,l)=>(o(),u("div",{key:l,class:"environment-item",style:{"margin-top":"10px",display:"flex",gap:"10px"}},[n(X,{modelValue:e.environment,"onUpdate:modelValue":a=>e.environment=a,placeholder:"请选择环境",style:{flex:"1"},clearable:""},{default:i((()=>[(o(!0),u(d,null,m(J.value,(e=>(o(),p(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),n(X,{modelValue:e.cluster,"onUpdate:modelValue":a=>e.cluster=a,placeholder:"请选择容器集群",style:{flex:"1"},clearable:""},{default:i((()=>[(o(!0),u(d,null,m(O.value,(e=>(o(),p(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),n(U,{modelValue:e.namespace,"onUpdate:modelValue":a=>e.namespace=a,placeholder:"请输入命名空间",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),n(re,{type:"danger",icon:"delete",onClick:e=>(e=>{ae.value.splice(e,1)})(l)},{default:i((()=>a[15]||(a[15]=[s("删除")]))),_:2},1032,["onClick"])])))),128))]),n(re,{type:"primary",icon:"plus",onClick:le},{default:i((()=>a[16]||(a[16]=[s("添加环境")]))),_:1}),a[17]||(a[17]=t("div",{class:"environment-info"},[t("p",null,"保证至少有一个可用的环境关联到应用。"),t("p",null,"使用 Kubernetes 部署能力将应用部署到容器集群，需要提前注册待部署的容器集群。"),t("p",null,"前置工作："),t("ul",null,[t("li",null,"注册 Kubernetes 集群，具体操作可参考 注册集群"),t("li",null,"新建环境信息")])],-1))])),_:1}),t("div",S,[n(re,{type:"default",onClick:$},{default:i((()=>a[18]||(a[18]=[s("上一步")]))),_:1}),n(re,{type:"primary",onClick:ee},{default:i((()=>a[19]||(a[19]=[s("提交")]))),_:1})])])):c("",!0)])])],64)}}},[["__scopeId","data-v-88155f56"]]);export{K as default};
