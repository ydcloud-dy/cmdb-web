/*! 
 Build based on  
 Time : 1735190558000 */
import{_ as e,a,q as l,a0 as t,P as s,o,c as i,e as r,w as u,b as d,F as n,v as p,g as c,t as m,f as v,a1 as f,i as g,k as y,E as j,Q as _}from"./index.ABWJOL2Q.js";import{E as w,a as h}from"./col.BzMVCOvM.js";import{E as b}from"./pagination.BfYt3rvk.js";/* empty css            */import"./select.C2tLDQ30.js";import{E as k}from"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              */import{E as x}from"./divider.CphDijCu.js";import{E as I}from"./dialog.DdLHJsLF.js";import"./overlay.CDLw2uOw.js";/* empty css             *//* empty css               */import{a as C,E as V}from"./form-item.ujPiwBAF.js";import{E as z,a as E,b as D}from"./dropdown-item.Bdep7Ju0.js";import{E as H}from"./card.RgDT494R.js";/* empty css             */import"./checkbox.BcMUmSPv.js";import{E as U}from"./virtual-list.D0tgIX0Q.js";import F from"./table.BBnbaYK_.js";import S from"./createHost.DsVL_qgh.js";import A from"./bulkImport.gmA0UGlU.js";import{g as N}from"./cmdbProjects.CXcaQTcF.js";import{I as P,u as q,A as K,G as L,c as O,f as X,d as G,g as M}from"./cmdbHosts.BvNxdKUP.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./refs.CZv2DkwS.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./dropdown.Co_mIot6.js";import"./table-column.ChuwY-lb.js";import"./drawer.XhtctEYG.js";import"./descriptions-item.C4J2YVui.js";/* empty css                */import"./popover.DFR01WU1.js";import"./stringFun.hIDu-B3o.js";import"./upload.-Ej7EZzx.js";import"./progress.KCbgDfe_.js";import"./cloneDeep.BwH6oqGn.js";const Q={class:"dycloud-search-box"},R={key:0},T={class:"dialog-footer"},W={key:1},Y={class:"dialog-footer"},Z={key:2},B={style:{display:"flex","align-items":"center"}},J={style:{"margin-top":"5px"}},$={class:"static-content-item"},ee={class:"static-content-item"},ae={class:"dycloud-table-box"},le={class:"dycloud-pagination"},te={name:"Index"},se=e(Object.assign(te,{setup(e){const te=a({}),se=a(""),oe={value:"id",label:"name",children:"region"},ie=a([]),re=a(1),ue=a(0),de=a(10),ne=a({keyword:"",region:"",field:""}),pe=a([]),ce=a([]),me=a("识别搜索"),ve=[{id:1,field:"name",name:"实例名称"},{id:2,field:"id",name:"实例ID"},{id:8,field:"os",name:"操作系统"},{id:10,field:"serverHost",name:"私网地址"}],fe=a(1),ge=a(null),ye=a(null),je=a({success:0,failure:0,successHosts:[],failureHosts:[],finished:!1}),_e=()=>{f((()=>{if(pe.value&&pe.value.length>0){const e=pe.value[0];Fe(e),ye.value&&ye.value.setCurrentKey(e.region),Oe()}}))},we=()=>{window.open("/#/hostTerminal","_blank")};l((()=>{(async()=>{const e=await N({page:re.value,pageSize:de.value,...ne.value});0===e.code&&(pe.value=e.data.list,_e())})(),_e()}));const he=a(!1),be=a(!1),ke=a(!1),xe=a(!1),Ie=a(""),Ce=a("root");let Ve=null;const ze=a(""),Ee=()=>{ze.value="import",se.value="导入主机",be.value=!0},De=()=>{ze.value="create",ie.value=null,se.value="创建主机",he.value=!0},He=()=>{he.value=!1,be.value=!1,ke.value=!1,te.value={}},Ue=a(0),Fe=e=>{e.ID&&(ne.value.region=e.region_id,fe.value=e.ID,Oe()),(e.region||null===e.region)&&(Ue.value=e.id)},Se=async e=>{let a;switch(e.password=Ie.value,e.port=parseInt(e.port,10),ge.value=e,ze.value){case"create":if(a=await K(e),177==a.code){ke.value=!0;break}break;case"update":a=await q(e);break;case"import":{if(je.value={success:0,failure:0,successHosts:[],failureHosts:[],finished:!1},!(e[0].raw instanceof File))break;const l=new FormData;l.append("file",e[0].raw),l.append("projectId",e.project),xe.value=!0,Ae(),a=await P(l,{donNotShowLoading:!0});break}}0===a.code&&(He(),Ke(a))};t((()=>{Ve&&clearInterval(Ve)}));const Ae=()=>{Ve=setInterval((async()=>{try{const e=await L();je.value=e.data,je.value.finished&&clearInterval(Ve)}catch(e){clearInterval(Ve)}}),2e3)},Ne=async()=>{let e;ge.value.password=Ie.value,e=await O(ge.value),0===e.code&&(He(),Ie.value="",Ke(e))},Pe=async e=>{ze.value="update";const a=await X({id:e.ID});a.data.items&&a.data.items.code?g({type:"error",message:a.data.items.message}):(he.value=!0,0===a.code&&(ie.value=a.data,se.value="更新主机",he.value=!0))},qe=async e=>{e.visible=!1;const a=await G({id:e.ID});a.data.items&&a.data.items.code?g({type:"error",message:a.data.items.message}):0===a.code&&(g({type:"success",message:"删除成功"}),Oe())},Ke=async e=>{0===e.code&&(g({type:"success",message:e.msg}),Oe())},Le=async e=>{const a=await X({id:e.ID});a.data.items&&a.data.items.code?g({type:"error",message:a.data.items.message}):0===a.code&&(te.value=a.data.items)},Oe=async()=>{const e=await M({page:re.value,pageSize:de.value,project:fe.value,...ne.value});0===e.code&&(ce.value=e.data.list,ue.value=e.data.total,re.value=e.data.page,de.value=e.data.pageSize)};Oe();const Xe=()=>{ne.value={},me.value="识别搜索",Ue.value=0},Ge=()=>{"识别搜索"!==ve.value?(re.value=1,de.value=10,Oe()):g({message:"请选择搜索类型",type:"warning"})},Me=e=>{de.value=e,Oe()},Qe=e=>{re.value=e,Oe()},Re=e=>{ne.value=e,Oe()};return(e,a)=>{const l=U,t=H,f=w,g=z,N=E,P=D,q=C,K=y,L=j,O=V,X=I,G=s("WarningFilled"),M=_,fe=x,ge=k,_e=b,Ve=h;return o(),i("div",null,[r(t,{class:"box-card",shadow:"hover"},{header:u((()=>a[7]||(a[7]=[d("div",{class:"card-header"},[d("span",null,"资产管理")],-1)]))),default:u((()=>[r(Ve,{gutter:24},{default:u((()=>[r(f,{span:3},{default:u((()=>[r(t,{class:"box-card",shadow:"hover"},{header:u((()=>a[8]||(a[8]=[d("div",{class:"card-header"},[d("span",null,"资源分布")],-1)]))),default:u((()=>[r(l,{ref_key:"treeRef",ref:ye,data:pe.value,props:oe,"node-key":"region","default-expanded-keys":["0"],"expand-on-click-node":!1,onNodeClick:Fe},null,8,["data"])])),_:1})])),_:1}),r(f,{span:21},{default:u((()=>[r(t,{class:"el-card"},{default:u((()=>[d("div",Q,[r(O,{ref:"searchForm",inline:!0,model:ne.value},{default:u((()=>[r(q,null,{default:u((()=>[r(P,{"split-button":""},{dropdown:u((()=>[r(N,null,{default:u((()=>[(o(),i(n,null,p(ve,((e,a)=>d("div",{key:a},[r(g,{onClick:a=>{return l=e.name,t=e.field,ne.value.field=t,void(me.value=l);var l,t}},{default:u((()=>[c(m(e.name),1)])),_:2},1032,["onClick"])]))),64))])),_:1})])),default:u((()=>[c(m(me.value)+" ",1)])),_:1})])),_:1}),r(q,null,{default:u((()=>[r(K,{modelValue:ne.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>ne.value.keyword=e),placeholder:"请输入搜索关字"},null,8,["modelValue"])])),_:1}),r(q,null,{default:u((()=>[r(L,{size:"small",type:"primary",icon:"search",onClick:Ge},{default:u((()=>a[9]||(a[9]=[c("查询")]))),_:1}),r(L,{size:"small",icon:"refresh",onClick:Xe},{default:u((()=>a[10]||(a[10]=[c("重置")]))),_:1}),r(L,{size:"small",type:"primary",icon:"plus",onClick:De},{default:u((()=>a[11]||(a[11]=[c("新增")]))),_:1}),r(L,{size:"small",type:"primary",icon:"plus",onClick:Ee},{default:u((()=>a[12]||(a[12]=[c("批量导入")]))),_:1}),r(L,{size:"small",type:"primary",icon:"plus",onClick:we},{default:u((()=>a[13]||(a[13]=[c("web终端")]))),_:1})])),_:1})])),_:1},8,["model"])]),he.value?(o(),i("div",R,[r(X,{modelValue:he.value,"onUpdate:modelValue":a[1]||(a[1]=e=>he.value=e),width:"650px",title:se.value},{default:u((()=>[d("div",T,[r(S,{form:te.value,data:pe.value,title:se.value,dataInfo:ie.value,operation:ze.value,type:"hosts",onClose:He,onEnter:Se},null,8,["form","data","title","dataInfo","operation"])])])),_:1},8,["modelValue","title"])])):v("",!0),be.value?(o(),i("div",W,[r(X,{modelValue:be.value,"onUpdate:modelValue":a[2]||(a[2]=e=>be.value=e),width:"650px",title:se.value},{default:u((()=>[d("div",Y,[r(A,{form:te.value,data:pe.value,title:se.value,dataInfo:ie.value,operation:ze.value,type:"hosts",onClose:He,onEnter:Se},null,8,["form","data","title","dataInfo","operation"])])])),_:1},8,["modelValue","title"])])):v("",!0),ke.value?(o(),i("div",Z,[r(X,{modelValue:ke.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ke.value=e),width:"400px",title:"密码验证"},{default:u((()=>[d("div",B,[r(M,null,{default:u((()=>[r(G)])),_:1}),a[14]||(a[14]=d("span",{style:{"margin-left":"10px"}},"首次验证请输入密码",-1))]),r(K,{modelValue:Ie.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Ie.value=e),type:"password",placeholder:"请输入密码",style:{"margin-top":"10px"}},null,8,["modelValue"]),d("div",J,"用户 "+m(Ce.value)+" 的密码，该密码仅做首次验证使用，不会存储该密码",1)])),footer:u((()=>[r(L,{onClick:a[4]||(a[4]=e=>ke.value=!1)},{default:u((()=>a[15]||(a[15]=[c("取消")]))),_:1}),r(L,{type:"primary",onClick:Ne},{default:u((()=>a[16]||(a[16]=[c("确定")]))),_:1})])),_:1},8,["modelValue"])])):v("",!0),r(X,{modelValue:xe.value,"onUpdate:modelValue":a[6]||(a[6]=e=>xe.value=e),title:"批量导入"},{default:u((()=>[d("div",null,[d("div",$,[r(fe,{direction:"horizontal"},{default:u((()=>a[17]||(a[17]=[c("导入结果")]))),_:1})])]),d("div",null,[d("p",null,"成功："+m(je.value.success),1),d("p",null,"失败："+m(je.value.failure),1)]),d("div",null,[d("div",ee,[r(fe,{direction:"horizontal"},{default:u((()=>a[18]||(a[18]=[c("验证与同步")]))),_:1})]),r(ge,null,{default:u((()=>[d("ul",null,[(o(!0),i(n,null,p(je.value.successHosts,((e,l)=>(o(),i("li",{key:l,class:"success"},[c(m(e)+"：",1),a[19]||(a[19]=d("span",{style:{color:"green"}},"成功",-1))])))),128)),(o(!0),i(n,null,p(je.value.failureHosts,((e,l)=>(o(),i("li",{key:l,class:"failure"},[c(m(e)+"：",1),a[20]||(a[20]=d("span",{style:{color:"red"}},"失败",-1))])))),128))])])),_:1})])])),_:1},8,["modelValue"]),d("div",ae,[r(F,{"table-data":ce.value,onSearch:Re,onUpdate:Pe,onDetail:Le,onDelete:qe},null,8,["table-data"])]),d("div",le,[r(_e,{"current-page":re.value,"page-size":de.value,"page-sizes":[10,30,50,100],total:ue.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:Qe,onSizeChange:Me},null,8,["current-page","page-size","total"])])])),_:1})])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-7befee5c"]]);export{se as default};
