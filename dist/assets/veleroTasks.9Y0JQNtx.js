/*! 
 Build based on  
 Time : 1735190558000 */
import{a as e,o as a,c as t,b as s,e as l,w as o,g as i,f as r,i as m,k as d,E as u}from"./index.ABWJOL2Q.js";import{E as p}from"./dialog.DdLHJsLF.js";import"./overlay.CDLw2uOw.js";import{E as n}from"./pagination.BfYt3rvk.js";/* empty css            */import"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              *//* empty css             *//* empty css               */import{a as c,E as v}from"./form-item.ujPiwBAF.js";import{g as j}from"./k8s.DUZ1Kw0R.js";import{_ as y}from"./index.CLE9PzC_.js";import g from"./table.DTqt8sAG.js";import _ from"./detail.BhVZTrzv.js";import f from"./createTask.9j_gi1n4.js";import{a as k,D as w,b,c as V,d as x}from"./velero.Buhf202L.js";import"./index.BRjlB3m5.js";import"./refs.CZv2DkwS.js";import"./index.D4uEcQv3.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./monaco-editor-vue3.es.BmYKexe9.js";import"./js-yaml.B_ZKWvuw.js";import"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                */import"./popover.DFR01WU1.js";import"./dropdown.Co_mIot6.js";import"./col.BzMVCOvM.js";import"./tab-pane.fs024GHS.js";import"./index.C5gbd99D.js";import"./card.RgDT494R.js";import"./detail-basic.C5XH3jbK.js";import"./age.Du5VDnjl.js";import"./link.QK3LjIND.js";import"./detail-pods.B6dtbEQc.js";import"./dropdown-item.Bdep7Ju0.js";import"./metrics.Dq7Dbl3h.js";import"./terminal.CkdZuQYW.js";import"./xterm.BR7SOqRe.js";/* empty css              */import"./xterm-addon-fit.onOJMBm7.js";import"./index.DDa397GF.js";import"./index.DrIIbIcU.js";import"./terminal-log.p9WpB3Ej.js";import"./monitor.CqRBZu0a.js";import"./date-picker.CCiP3Fyg.js";import"./dayjs.min.DOWqlKAh.js";import"./arrays.CvpzyGiz.js";import"./index.7ugBSK5z.js";import"./detail-ports.B1_yjkTj.js";/* empty css                    *//* empty css              */import"./namespaces.DIn9v7pI.js";import"./index.DINKPDpR.js";const h={class:"dycloud-table-box"},C={class:"dycloud-btn-list"},E={key:0},z={class:"dycloud-pagination"},T={key:0},N={class:"dialog-footer"},I={key:1},S={class:"dialog-footer"},U={key:2},D={class:"dialog-footer"},L={name:"veleroTasks"},A=Object.assign(L,{setup(L){const A=e({}),F=e(1),M=e(0),O=e(10),H=e([]),K=e(""),Y=e({keywords:"",namespace:""}),q=e(!1),B=()=>{Y.value.keywords=""},J=e(!1),R=()=>{F.value=1,O.value=10,P()},X=e=>{O.value=e,P()},G=e=>{F.value=e,P()},P=async()=>{const e=await k({cluster_id:Y.value.cluster_id,page:F.value,pageSize:O.value,namespace:Y.value.namespace,keyword:Y.value.keywords});0===e.code&&(e.data.items.forEach((e=>{e.metadata.creationTimestamp&&(e.metadata.creationTimestamp=new Date(e.metadata.creationTimestamp).toLocaleString())})),H.value=e.data.items,M.value=e.data.total,F.value=e.data.page,O.value=e.data.pageSize)},Q=e(!1),W=e(""),Z=async e=>{W.value="update",K.value="编辑";const a=await w({cluster_id:Y.value.cluster_id,namespace:e.metadata.namespace,VeleroTaskName:e.metadata.name});a.data.items&&a.data.items.code?m({type:"error",message:a.data.items.message}):0===a.code&&(A.value=a.data.items,Q.value=!0)},$=async e=>{J.value=!0,W.value="update",K.value="编辑";const a=await w({cluster_id:Y.value.cluster_id,namespace:e.metadata.namespace,VeleroTaskName:e.metadata.name});a.data.items&&a.data.items.code?m({type:"error",message:a.data.items.message}):0===a.code&&(A.value=a.data.items,q.value=!0,se.value=!0)},ee=()=>{Q.value=!1,se.value=!1,le.value=!1,A.value={}},ae=async e=>{e.visible=!1;const a=await b({cluster_id:Y.value.cluster_id,namespace:e.metadata.namespace,VeleroTaskName:e.metadata.name});a.data.items&&a.data.items.code?m({type:"error",message:a.data.items.message}):0===a.code&&(m({type:"success",message:"删除成功"}),P())},te=async e=>{let a;switch(W.value){case"create":default:a=await V({cluster_id:Y.value.cluster_id,content:e});break;case"update":{const t=await w({cluster_id:Y.value.cluster_id,namespace:"velero",VeleroTaskName:e.metadata.name});e.metadata.resourceVersion=t.data.items.metadata.resourceVersion,a=await x({cluster_id:Y.value.cluster_id,namespace:e.metadata.namespace,VeleroTaskName:e.metadata.name,content:e});break}}a.data.items&&a.data.items.code?m({type:"error",message:a.data.items.message}):0===a.code&&(ee(),(async e=>{0===e.code&&(m({type:"success",message:e.msg}),P())})(a))},se=e(!1),le=e(!1),oe=async e=>{const a=await w({cluster_id:Y.value.cluster_id,namespace:e.metadata.namespace,VeleroTaskName:e.metadata.name});a.data.items&&a.data.items.code?m({type:"error",message:a.data.items.message}):(0===a.code&&(K.value="详情",A.value=a.data.items,A.value.cluster_id=Y.value.cluster_id,A.value.type="deployment"),Q.value=!0)};return window.addEventListener("setItemCluster",(e=>{Y.value.cluster_id=parseInt(localStorage.getItem("cluster_id"))})),window.addEventListener("setItemNamespace",(e=>{Y.value.namespace=localStorage.getItem("namespace"),P()})),(e,m)=>{const k=d,w=c,b=u,V=v,x=n,L=p;return a(),t("div",null,[s("div",h,[s("div",C,[l(V,{ref:"searchForm",inline:!0,model:Y.value},{default:o((()=>[l(w,{label:"名称"},{default:o((()=>[l(k,{modelValue:Y.value.keywords,"onUpdate:modelValue":m[0]||(m[0]=e=>Y.value.keywords=e),placeholder:"名称"},null,8,["modelValue"])])),_:1}),l(w,null,{default:o((()=>[l(b,{size:"small",type:"primary",icon:"search",onClick:R},{default:o((()=>m[6]||(m[6]=[i("查询")]))),_:1}),l(b,{size:"small",icon:"refresh",onClick:B},{default:o((()=>m[7]||(m[7]=[i("重置")]))),_:1}),l(b,{size:"small",type:"primary",icon:"plus",onClick:m[1]||(m[1]=e=>(W.value="create",K.value="创建",A.value=j("schedule",Y.value.namespace,""),void(Q.value=!0)))},{default:o((()=>m[8]||(m[8]=[i("YAML")]))),_:1}),l(b,{size:"small",type:"primary",icon:"plus",onClick:m[2]||(m[2]=e=>(J.value=!1,W.value="create",K.value="创建",q.value=!1,A.value=j("schedule",Y.value.namespace,""),void(se.value=!0)))},{default:o((()=>m[9]||(m[9]=[i("新增")]))),_:1})])),_:1})])),_:1},8,["model"])]),H.value?(a(),t("div",E,[l(g,{"table-data":H.value,onYaml_update:Z,onUpdate:$,onDetail:oe,onDelete:ae},null,8,["table-data"])])):r("",!0)]),s("div",z,[l(x,{"current-page":F.value,"page-size":O.value,"page-sizes":[10,30,50,100],total:M.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:G,onSizeChange:X},null,8,["current-page","page-size","total"])]),Q.value?(a(),t("div",T,[l(L,{modelValue:Q.value,"onUpdate:modelValue":m[3]||(m[3]=e=>Q.value=e),width:"60%",title:K.value},{default:o((()=>[s("div",N,[l(y,{data:A.value,onClose:ee,onEnter:te},null,8,["data"])])])),_:1},8,["modelValue","title"])])):r("",!0),se.value?(a(),t("div",I,[l(L,{modelValue:se.value,"onUpdate:modelValue":m[4]||(m[4]=e=>se.value=e),title:J.value?"更新":"新增",width:"70%"},{default:o((()=>[s("div",S,[l(f,{cluster:Y.value.cluster_id,"is-update":J.value,form:A.value,readonly:q.value,onClose:ee,onEnter:te},null,8,["cluster","is-update","form","readonly"])])])),_:1},8,["modelValue","title"])])):r("",!0),le.value?(a(),t("div",U,[l(L,{modelValue:le.value,"onUpdate:modelValue":m[5]||(m[5]=e=>le.value=e),width:"70%",title:K.value},{default:o((()=>[s("div",D,[l(_,{data:A.value,"read-only":q.value,onClose:ee,onEnter:te},null,8,["data","read-only"])])])),_:1},8,["modelValue","title"])])):r("",!0)])}}});export{A as default};
