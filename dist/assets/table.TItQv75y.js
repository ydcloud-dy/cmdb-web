/*! 
 Build based on  
 Time : 1735190558000 */
import{_ as e,u as a,a as l,q as r,o,c as t,e as u,w as p,O as n,g as s,t as i,b as d,F as m,v as c,h as v,f as g,i as f,x as b,E as k,k as h}from"./index.ABWJOL2Q.js";import{E as y}from"./dialog.DdLHJsLF.js";import"./overlay.CDLw2uOw.js";import{E as _,a as w}from"./col.BzMVCOvM.js";/* empty css             *//* empty css            */import{E as D,a as N}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               */import{a as V,E as j}from"./form-item.ujPiwBAF.js";/* empty css              */import{E as I,a as C}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                */import{E as x}from"./popover.DFR01WU1.js";/* empty css               */import{E as U}from"./link.QK3LjIND.js";import{d as R}from"./dayjs.min.DOWqlKAh.js";import{t as q}from"./stringFun.hIDu-B3o.js";import{u as E,d as z}from"./applications.GrMV9Sfs.js";import{g as A}from"./environment.Z24KwZWA.js";import{g as M}from"./k8sCluster.LvLN1W31.js";import"./index.BRjlB3m5.js";import"./refs.CZv2DkwS.js";import"./index.D4uEcQv3.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./dropdown.Co_mIot6.js";const S={style:{"text-align":"right","margin-top":"8px"}},Y={slot:"footer",class:"dialog-footer"},F={slot:"footer",class:"dialog-footer"},H=e({__name:"table",props:{tableData:{default:function(){return[]},type:Array}},emits:["update","delete","search","region","test"],setup(e,{emit:H}){const L=a(),K=H,O=l(1),B=l(!1),G=l({ID:"",gitRepo:"",branch:"",appName:"",appCode:"",appDesc:"",language:"",owner:[],developers:[]}),J={gitRepo:[{required:!0,message:"代码仓库不能为空",trigger:"blur"}],branch:[{required:!0,message:"主干分支不能为空",trigger:"blur"}],appCode:[{required:!0,message:"应用标识不能为空",trigger:"blur"}],appName:[{required:!0,message:"应用名称不能为空",trigger:"blur"}],owner:[{required:!0,message:"负责人不能为空",trigger:"change"}],developers:[{required:!0,message:"开发人员不能为空",trigger:"change"}],language:[{required:!0,message:"程序设计语言不能为空",trigger:"change"}]},P=(e,a,l)=>l?R(l).format("YYYY-MM-DD HH:mm:ss"):"",T=l({}),Q=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),T.value.orderKey=q(e),T.value.desc="descending"===a),K("search",T.value)},W=l(null),X={env:[{required:!0,message:"请选择环境",trigger:"change"}],cluster:[{required:!0,message:"请选择集群",trigger:"change"}],namespace:[{required:!0,message:"请输入命名空间",trigger:"blur"}]},Z=async()=>{if(1===O.value){await $.value.validate()&&(await oe(),await te(),O.value=2)}},$=l(null),ee=()=>{ae.value.push({env:"",cluster:"",namespace:""})},ae=l([{env:"",cluster:"",namespace:""}]);l([]);const le=l([]),re=l([]),oe=async()=>{const e=await A({page:1,pageSize:1e3});0===e.code?le.value=e.data.list.map((e=>({value:e.key,label:e.name}))):f.error("获取环境列表失败！")},te=async()=>{const e=await M({page:1,pageSize:1e3});0===e.code?re.value=e.data.list.map((e=>({value:e.id,label:e.name}))):f.error("获取集群列表失败！")},ue=async()=>{try{if(!(await W.value.validate()))return void f.error("请检查表单信息是否完整！");const e={envs:ae.value.map((e=>{const a=re.value.find((a=>a.value===e.cluster)),l=le.value.find((a=>a.value===e.env));return{ID:e.ID||null,clusterName:a?a.label:"",clusterId:a?a.value:null,envCode:e.env,envName:l?l.label:"",namespace:e.namespace}})),app:{ID:G.value.ID,gitRepo:G.value.gitRepo,branch:G.value.branch,appName:G.value.appName,appCode:G.value.appCode,appDesc:G.value.appDesc,develop:G.value.developers.map((e=>{const a=pe.value.find((a=>a.ID===e));return{ID:a.ID,label:a.nickName,value:a.userName,key:a.nickName,option:{avatar:a.avatar||"",nickname:a.nickName,username:a.userName},originLabel:a.nickName}})),owner:G.value.owner.map((e=>{const a=pe.value.find((a=>a.ID===e));return{ID:a.ID,label:a.nickName,value:a.userName,key:a.nickName,option:{avatar:a.avatar||"",nickname:a.nickName,username:a.userName},originLabel:a.nickName}})),language:G.value.language}},a=await E(e);0===a.code?(f.success("应用更新成功！"),B.value=!1,O.value=1,K("update","")):f.error(a.msg||"更新应用失败！")}catch(e){f.error("提交失败，请稍后重试！")}},pe=l([]);r((async()=>{await(async()=>{try{const e=await b({page:1,pageSize:100});if(0===e.code){const a=e.data.list.map((e=>({ID:e.ID,userName:e.userName,nickName:e.nickName}))),l=[...pe.value,...a];pe.value=Array.from(new Map(l.map((e=>[e.ID,e]))).values())}else f.error(e.msg||"获取用户列表失败！")}catch(e){f.error("请求失败，请稍后重试！")}})(),await oe(),await te()}));const ne=e=>{K("select",e)};return(a,l)=>{const r=I,b=U,R=k,q=x,E=C,A=h,M=V,H=D,T=N,oe=j,te=_,se=w,ie=y;return o(),t("div",null,[u(E,{ref:"multipleTable",data:e.tableData,style:{width:"100%"},"tooltip-effect":"dark","row-key":"ID",onSortChange:Q,onSelectionChange:ne,"highlight-current-row":""},{default:p((()=>[u(r,{type:"selection",width:"55"}),u(r,{align:"left",label:"ID",prop:"ID",width:"80",sortable:"custom"}),u(r,{align:"left",label:"应用名",prop:"appName",sortable:"custom"},{default:p((e=>[u(b,{onClick:n((a=>{return l=e.row.ID,void L.push({name:"applicationDetail",query:{id:l}});var l}),["prevent"]),style:{cursor:"pointer"}},{default:p((()=>[s(i(e.row.appName),1)])),_:2},1032,["onClick"])])),_:1}),u(r,{align:"left",label:"应用标识",prop:"appCode"}),u(r,{align:"left",label:"语言",prop:"language"}),u(r,{align:"left",label:"默认分支",prop:"branch"}),u(r,{align:"left",label:"仓库地址",prop:"gitRepo","show-overflow-tooltip":""},{default:p((e=>[u(b,{href:e.row.gitRepo,target:"_blank"},{default:p((()=>[s(i(e.row.gitRepo),1)])),_:2},1032,["href"])])),_:1}),u(r,{align:"left",label:"创建时间",prop:"CreatedAt",formatter:P}),u(r,{align:"left",label:"操作"},{default:p((e=>[u(R,{size:"small",type:"primary",link:"",icon:"edit",onClick:a=>(async e=>{try{const a=await z(e.ID);if(0===a.code){const e=a.data,l=[...e.owner.map((e=>({ID:e.ID,userName:e.userName||e.value,nickName:e.nickName||e.label}))),...e.develop.map((e=>({ID:e.ID,userName:e.userName||e.value,nickName:e.nickName||e.label})))],r=[...pe.value,...l];pe.value=Array.from(new Map(r.map((e=>[e.userName,e]))).values()),ae.value=e.envs.map((e=>({ID:e.ID,env:e.envCode,cluster:e.clusterName,namespace:e.namespace}))),G.value={ID:e.ID,gitRepo:e.gitRepo||"",branch:e.branch||"",appName:e.appName||"",appCode:e.appCode||"",appDesc:e.appDesc||"",language:e.language||"",owner:e.owner.map((e=>{var a;return null==(a=pe.value.find((a=>a.userName===e.value)))?void 0:a.ID})).filter((e=>e)),developers:e.develop.map((e=>{var a;return null==(a=pe.value.find((a=>a.userName===e.value)))?void 0:a.ID})).filter((e=>e))},B.value=!0}else f.error(a.msg||"获取应用详情失败！")}catch(a){f.error("请求失败，请稍后重试！")}})(e.row)},{default:p((()=>l[11]||(l[11]=[s("编辑")]))),_:2},1032,["onClick"]),u(q,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top"},{reference:p((()=>[u(R,{type:"primary",link:"",icon:"delete",size:"small",onClick:a=>e.row.visible=!0},{default:p((()=>l[14]||(l[14]=[s("删除")]))),_:2},1032,["onClick"])])),default:p((()=>[l[15]||(l[15]=d("p",null,"确定要删除吗？",-1)),d("div",S,[u(R,{size:"small",type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:p((()=>l[12]||(l[12]=[s("取消")]))),_:2},1032,["onClick"]),u(R,{type:"primary",size:"small",onClick:a=>{return l=e.row,void K("delete",l);var l}},{default:p((()=>l[13]||(l[13]=[s("确定")]))),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),u(ie,{title:"修改应用",modelValue:B.value,"onUpdate:modelValue":l[10]||(l[10]=e=>B.value=e),width:"700px"},{default:p((()=>[1===O.value?(o(),t(m,{key:0},[u(oe,{model:G.value,rules:J,ref_key:"editFormRef",ref:$,"label-width":"120px"},{default:p((()=>[l[16]||(l[16]=d("h3",null,"基本信息",-1)),u(M,{label:"代码仓库",prop:"gitRepo"},{default:p((()=>[u(A,{modelValue:G.value.gitRepo,"onUpdate:modelValue":l[0]||(l[0]=e=>G.value.gitRepo=e),placeholder:"请输入代码仓库地址"},null,8,["modelValue"])])),_:1}),u(M,{label:"主干分支",prop:"branch"},{default:p((()=>[u(A,{modelValue:G.value.branch,"onUpdate:modelValue":l[1]||(l[1]=e=>G.value.branch=e),placeholder:"请输入主干分支"},null,8,["modelValue"])])),_:1}),u(M,{label:"应用名称",prop:"appName"},{default:p((()=>[u(A,{modelValue:G.value.appName,"onUpdate:modelValue":l[2]||(l[2]=e=>G.value.appName=e),placeholder:"请输入应用名称"},null,8,["modelValue"])])),_:1}),u(M,{label:"应用标识",prop:"appCode"},{default:p((()=>[u(A,{modelValue:G.value.appCode,"onUpdate:modelValue":l[3]||(l[3]=e=>G.value.appCode=e),placeholder:"请输入应用标识"},null,8,["modelValue"])])),_:1}),u(M,{label:"应用描述",prop:"appDesc"},{default:p((()=>[u(A,{modelValue:G.value.appDesc,"onUpdate:modelValue":l[4]||(l[4]=e=>G.value.appDesc=e),type:"textarea",maxlength:"100","show-word-limit":"",placeholder:"请输入应用描述"},null,8,["modelValue"])])),_:1}),l[17]||(l[17]=d("h3",null,"研发信息",-1)),u(M,{label:"负责人",prop:"owner"},{default:p((()=>[u(T,{modelValue:G.value.owner,"onUpdate:modelValue":l[5]||(l[5]=e=>G.value.owner=e),multiple:"",placeholder:"请选择负责人","value-key":"ID",clearable:!0},{default:p((()=>[(o(!0),t(m,null,c(pe.value,(e=>(o(),v(H,{key:e.ID,label:"".concat(e.userName," / ").concat(e.nickName),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(M,{label:"开发",prop:"developers"},{default:p((()=>[u(T,{modelValue:G.value.developers,"onUpdate:modelValue":l[6]||(l[6]=e=>G.value.developers=e),multiple:"",placeholder:"请选择开发人员","value-key":"ID",clearable:!0},{default:p((()=>[(o(!0),t(m,null,c(pe.value,(e=>(o(),v(H,{key:e.ID,label:"".concat(e.userName," / ").concat(e.nickName),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(M,{label:"程序设计语言",prop:"language"},{default:p((()=>[u(T,{modelValue:G.value.language,"onUpdate:modelValue":l[7]||(l[7]=e=>G.value.language=e),placeholder:"请选择程序设计语言"},{default:p((()=>[u(H,{label:"Java",value:"java"}),u(H,{label:"Golang",value:"golang"}),u(H,{label:"Python",value:"python"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"]),d("div",Y,[u(R,{onClick:l[8]||(l[8]=e=>B.value=!1)},{default:p((()=>l[18]||(l[18]=[s("取消")]))),_:1}),u(R,{type:"primary",onClick:Z},{default:p((()=>l[19]||(l[19]=[s("下一步")]))),_:1})])],64)):2===O.value?(o(),v(oe,{key:1,ref_key:"formRef",ref:W,model:ae.value,rules:X,"label-width":"80px"},{default:p((()=>[d("div",null,[(o(!0),t(m,null,c(ae.value,((e,a)=>(o(),v(se,{key:a,gutter:20,align:"middle"},{default:p((()=>[u(te,{span:6},{default:p((()=>[u(M,{label:"环境",prop:"["+a+"].env"},{default:p((()=>[u(T,{modelValue:e.env,"onUpdate:modelValue":a=>e.env=a,placeholder:"请选择环境",clearable:""},{default:p((()=>[(o(!0),t(m,null,c(le.value,(e=>(o(),v(H,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:2},1024),u(te,{span:6},{default:p((()=>[u(M,{label:"集群",prop:"["+a+"].cluster"},{default:p((()=>[u(T,{modelValue:e.cluster,"onUpdate:modelValue":a=>e.cluster=a,placeholder:"请选择容器集群",clearable:""},{default:p((()=>[(o(!0),t(m,null,c(re.value,(e=>(o(),v(H,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:2},1024),u(te,{span:6},{default:p((()=>[u(M,{label:"空间",prop:"["+a+"].namespace"},{default:p((()=>[u(A,{modelValue:e.namespace,"onUpdate:modelValue":a=>e.namespace=a,placeholder:"请输入命名空间",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["prop"])])),_:2},1024),u(te,{span:2},{default:p((()=>[u(R,{type:"text",icon:"el-icon-delete",circle:"",onClick:e=>(e=>{ae.value.length>1?ae.value.splice(e,1):f.warning("至少需要一个环境配置！")})(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),u(R,{type:"dashed",icon:"el-icon-plus",onClick:ee,style:{width:"100%",border:"2px dashed #dcdfe6","margin-top":"20px",background:"none",color:"#606266"}},{default:p((()=>l[20]||(l[20]=[s(" 添加环境 ")]))),_:1})]),d("div",F,[u(R,{onClick:l[9]||(l[9]=e=>O.value=1)},{default:p((()=>l[21]||(l[21]=[s("上一步")]))),_:1}),u(R,{type:"primary",onClick:ue},{default:p((()=>l[22]||(l[22]=[s("提交")]))),_:1})])])),_:1},8,["model"])):g("",!0)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-f4ed8a2e"]]);export{H as default};
