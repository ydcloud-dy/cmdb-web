/*! 
 Build based on  
 Time : 1735190558000 */
import{z as e,R as a,a1 as l,bX as t,$ as o,aj as s,H as n,y as d,Z as r,a8 as i,ag as u,aX as c,cD as p,V as v,ae as m,a as f,r as y,q as h,bQ as k,C,L as b,P as g,o as D,c as I,b as _,e as x,w as V,g as j,t as w,h as N,F as U,v as z,cu as E,i as K,E as O,Q as S,k as A,x as M}from"./index.ABWJOL2Q.js";/* empty css            */import{a as H,E as L}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               */import{E as B}from"./dialog.DdLHJsLF.js";import"./overlay.CDLw2uOw.js";/* empty css             */import{a as T,E as q}from"./form-item.ujPiwBAF.js";/* empty css             */import"./checkbox.BcMUmSPv.js";import{E as R}from"./pagination.BfYt3rvk.js";/* empty css              */import{E as P,a as X}from"./table-column.ChuwY-lb.js";/* empty css                *//* empty css               */import{E as F,a as Q,b as Z}from"./dropdown-item.Bdep7Ju0.js";import{f as $,d as Y,u as G,c as J,b as W,e as ee,h as ae,i as le,t as te,j as oe,k as se}from"./organization.Ciq4f5Cp.js";import{E as ne}from"./index.D4uEcQv3.js";import{E as de}from"./index.HOewoZCo.js";import{e as re}from"./strings.C2tuonvC.js";import{i as ie}from"./isEqual.CtpQH3Dm.js";import{s as ue}from"./token.DWNpOE8r.js";import"./index.DglrVZRl.js";import"./castArray.9wqFpW2Z.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.6ock-Gvr.js";import"./index.BRjlB3m5.js";import"./refs.CZv2DkwS.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./dropdown.Co_mIot6.js";import"./index.gYVODlrW.js";const ce=d({extends:L,setup(e,t){const o=L.setup(e,t);delete o.selectOptionClick;const s=r().proxy;return l((()=>{o.select.states.cachedOptions.get(s.value)||o.select.onOptionCreate(s)})),a((()=>t.attrs.visible),(e=>{o.states.visible=e}),{immediate:!0}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function pe(e){return e||0===e}function ve(e){return i(e)&&e.length}function me(e){return i(e)?e:pe(e)?[e]:[]}function fe(e,a,l,t,o){for(let s=0;s<e.length;s++){const n=e[s];if(a(n,s,e,o))return t?t(n,s,e,o):n;{const e=l(n);if(ve(e)){const o=fe(e,a,l,t,n);if(o)return o}}}}function ye(e,a,l,t){for(let o=0;o<e.length;o++){const s=e[o];a(s,o,e,t);const n=l(s);ve(n)&&ye(n,a,l,s)}}var he=d({props:{data:{type:Array,default:()=>[]}},setup(e){const l=v(ue);return a((()=>e.data),(()=>{var a;e.data.forEach((e=>{l.states.cachedOptions.has(e.value)||l.states.cachedOptions.set(e.value,e)}));const t=(null==(a=l.selectRef)?void 0:a.querySelectorAll("input"))||[];m&&!Array.from(t).includes(document.activeElement)&&l.setSelected()}),{flush:"post",immediate:!0}),()=>{}}});const ke=b(C(d({name:"ElTreeSelect",inheritAttrs:!1,props:{...H.props,...de.props,cacheData:{type:Array,default:()=>[]}},setup(d,r){const{slots:i,expose:v}=r,m=f(),C=f(),b=n((()=>d.nodeKey||d.valueKey||"value")),g=((d,{attrs:r,emit:i},{select:u,tree:c,key:p})=>{const v=e("tree-select");return a((()=>d.data),(()=>{d.filterable&&l((()=>{var e,a;null==(a=c.value)||a.filter(null==(e=u.value)?void 0:e.states.inputValue)}))}),{flush:"post"}),{...t(o(d),Object.keys(H.props)),...r,"onUpdate:modelValue":e=>i(s,e),valueKey:p,popperClass:n((()=>{const e=[v.e("popper")];return d.popperClass&&e.push(d.popperClass),e.join(" ")})),filterMethod:(e="")=>{var a;d.filterMethod?d.filterMethod(e):d.remoteMethod?d.remoteMethod(e):null==(a=c.value)||a.filter(e)}}})(d,r,{select:m,tree:C,key:b}),{cacheOptions:D,...I}=((e,{attrs:d,slots:r,emit:i},{select:v,tree:m,key:f})=>{a((()=>e.modelValue),(()=>{e.showCheckbox&&l((()=>{const a=m.value;a&&!ie(a.getCheckedKeys(),me(e.modelValue))&&a.setCheckedKeys(me(e.modelValue))}))}),{immediate:!0,deep:!0});const y=n((()=>({value:f.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props}))),h=(e,a)=>{var l;const t=y.value[e];return u(t)?t(a,null==(l=m.value)?void 0:l.getNode(h("value",a))):a[t]},k=me(e.modelValue).map((a=>fe(e.data||[],(e=>h("value",e)===a),(e=>h("children",e)),((e,a,l,t)=>t&&h("value",t))))).filter((e=>pe(e))),C=n((()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const a=[];return ye(e.data.concat(e.cacheData),(e=>{const l=h("value",e);a.push({value:l,currentLabel:h("label",e),isDisabled:h("disabled",e)})}),(e=>h("children",e))),a})),b=()=>{var e;return null==(e=m.value)?void 0:e.getCheckedKeys().filter((e=>{var a;const l=null==(a=m.value)?void 0:a.getNode(e);return!c(l)&&p(l.childNodes)}))};return{...t(o(e),Object.keys(de.props)),...d,nodeKey:f,expandOnClickNode:n((()=>!e.checkStrictly&&e.expandOnClickNode)),defaultExpandedKeys:n((()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(k):k)),renderContent:(a,{node:l,data:t,store:o})=>a(ce,{value:h("value",t),label:h("label",t),disabled:h("disabled",t),visible:l.visible},e.renderContent?()=>e.renderContent(a,{node:l,data:t,store:o}):r.default?()=>r.default({node:l,data:t,store:o}):void 0),filterNodeMethod:(a,l,t)=>e.filterNodeMethod?e.filterNodeMethod(a,l,t):!a||new RegExp(re(a),"i").test(h("label",l)||""),onNodeClick:(a,l,t)=>{var o,s,n,r;if(null==(o=d.onNodeClick)||o.call(d,a,l,t),!e.showCheckbox||!e.checkOnClickNode){if(e.showCheckbox||!e.checkStrictly&&!l.isLeaf)e.expandOnClickNode&&t.proxy.handleExpandIconClick();else if(!h("disabled",a)){const e=null==(s=v.value)?void 0:s.states.options.get(h("value",a));null==(n=v.value)||n.handleOptionSelect(e)}null==(r=v.value)||r.focus()}},onCheck:(a,t)=>{var o;if(!e.showCheckbox)return;const n=h("value",a),r={};ye([m.value.store.root],(e=>r[e.key]=e),(e=>e.childNodes));const u=t.checkedKeys,c=e.multiple?me(e.modelValue).filter((e=>!(e in r)&&!u.includes(e))):[],p=c.concat(u);if(e.checkStrictly)i(s,e.multiple?p:p.includes(n)?n:void 0);else if(e.multiple){const e=b();i(s,c.concat(e))}else{const l=fe([a],(e=>!ve(h("children",e))&&!h("disabled",e)),(e=>h("children",e))),t=l?h("value",l):void 0,o=pe(e.modelValue)&&!!fe([a],(a=>h("value",a)===e.modelValue),(e=>h("children",e)));i(s,t===e.modelValue||o?void 0:t)}l((()=>{var l;const t=me(e.modelValue);m.value.setCheckedKeys(t),null==(l=d.onCheck)||l.call(d,a,{checkedKeys:m.value.getCheckedKeys(),checkedNodes:m.value.getCheckedNodes(),halfCheckedKeys:m.value.getHalfCheckedKeys(),halfCheckedNodes:m.value.getHalfCheckedNodes()})})),null==(o=v.value)||o.focus()},onNodeExpand:(a,t,o)=>{var n;null==(n=d.onNodeExpand)||n.call(d,a,t,o),l((()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&t.checked){const a={},l=m.value.getCheckedKeys();ye([m.value.store.root],(e=>a[e.key]=e),(e=>e.childNodes));const t=me(e.modelValue).filter((e=>!(e in a)&&!l.includes(e))),o=b();i(s,t.concat(o))}}))},cacheOptions:C}})(d,r,{select:m,tree:C,key:b}),_=y({});return v(_),h((()=>{Object.assign(_,{...t(C.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...t(m.value,["focus","blur","selectedLabel"])})})),()=>k(H,y({...g,ref:e=>m.value=e}),{...i,default:()=>[k(he,{data:D.value}),k(de,y({...I,ref:e=>C.value=e}))]})}}),[["__file","tree-select.vue"]])),Ce={class:"p-4"},be={class:"dycloud-organization-box"},ge={class:"dycloud-organization-box-left"},De={class:"toolbar"},Ie={class:"tree-body"},_e={class:"tree-body-tree-node"},xe={class:"tree-body-tree-node-label"},Ve={class:"el-more-filled"},je={class:"dycloud-organization-box-right"},we={class:"toolbar"},Ne={class:"toolbar-search"},Ue={class:"table-body"},ze={class:"dycloud-pagination"},Ee={name:"Organization"},Ke=Object.assign(Ee,{setup(e){const a={value:"ID",children:"children",label:"name"},l=f(0);f([]);const t=f(!1),o=f([]),s=f([]),n=async()=>{const e=await se();0===e.code&&null!==e.data&&(s.value=e.data)},d=f({ID:0,parentID:0,name:""}),r=f("add"),i=e=>{d.value={ID:0,parentID:e,name:""},r.value="add",t.value=!0},u=()=>{d.value={ID:0,parentID:0,name:""},c(s.value,!1),t.value=!1},c=(e,a)=>{e.forEach((e=>{e.disabled=a,e.children&&c(e.children,a)}))},p=(e,a)=>{e.forEach((e=>{e.ID===a&&c([e],!0),e.children&&p(e.children,a)}))},v=async()=>{switch(r.value){case"add":0===(await J(d.value)).code&&(u(),n());break;case"edit":0===(await G(d.value)).code&&(u(),n());break}},m=e=>{o.value=e},y=f({}),h=f(!1),k=f({sysUserIDS:[],organizationID:""}),C=async()=>{y.value={};const e=await W({organizationID:l.value});0===e.code&&e.data&&e.data.forEach((e=>{y.value[e]=!0})),k.value.organizationID=l.value,h.value=!0},b=e=>{l.value=e.ID,ye()},re=f(null),ie=async(e,a)=>{0===(await ee({sysUserID:e,isAdmin:a})).code&&(K.success("设置成功"),ye())},ue=f([]),ce=f(1),pe=f(10),ve=f(0),me=e=>{ce.value=e,ye()},fe=e=>{pe.value=e,ye()},ye=async()=>{const e=await ae({organizationID:l.value,page:ce.value,pageSize:pe.value,...Ee.value});0===e.code&&(ce.value=e.data.page,pe.value=e.data.pageSize,ve.value=e.data.total,ue.value=e.data.list)},he=f([]),Ee=f({userName:""}),Ke=async e=>{E.confirm("确定删除选中用户吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1}).then((async()=>{0===(await le({sysUserIDS:e,organizationID:l.value})).code&&(K.success("删除成功"),ye(),o.value=[])})).catch((()=>{K.info("取消删除")}))},Oe=()=>{k.value.sysUserIDS=[],h.value=!1},Se=f({sysUserIDS:[],organizationID:0,toOrganizationID:void 0}),Ae=f(!1),Me=e=>{Se.value.organizationID=l.value,Se.value.sysUserIDS=e?[e]:o.value.map((e=>e.sysUser.ID)),Ae.value=!0},He=()=>{Ae.value=!1,Se.value.sysUserIDS=[],Se.value.toOrganizationID=void 0},Le=async()=>{0===(await te(Se.value)).code&&(K.success("转移成功"),ye(),o.value=[],He())},Be=async()=>{h.value=!1;0===(await oe(k.value)).code&&(K.success("添加成功"),Oe(),ye())};return(async()=>{await n(),re.value.setCurrentKey(s.value[0].ID),(async()=>{const e=await M({page:1,pageSize:9999});he.value=e.data.list,ve.value=e.data.total})(),l.value=s.value[0].ID,ye()})(),(e,l)=>{const c=O,f=ne,M=g("more-filled"),G=S,J=g("Plus"),W=F,ee=g("CirclePlus"),ae=g("Delete"),le=Q,te=Z,oe=de,se=A,Te=P,qe=X,Re=R,Pe=ke,Xe=T,Fe=q,Qe=B,Ze=L,$e=H;return D(),I("div",Ce,[_("div",be,[_("div",ge,[_("div",De,[x(c,{type:"primary",onClick:l[0]||(l[0]=e=>i(0))},{default:V((()=>l[14]||(l[14]=[j("新增组织")]))),_:1})]),_("div",Ie,[x(oe,{ref_key:"treeRef",ref:re,data:s.value,"default-expand-all":"","node-key":"ID",props:a,"expand-on-click-node":!1,"highlight-current":"",onCurrentChange:b},{default:V((({node:e,data:a})=>[_("span",_e,[x(f,{class:"box-item",effect:"dark","show-after":600,content:e.label,placement:"top-start"},{default:V((()=>[_("span",xe,w(e.label),1)])),_:2},1032,["content"]),_("span",null,[x(te,null,{dropdown:V((()=>[x(le,null,{default:V((()=>[x(W,{onClick:e=>i(a.ID)},{default:V((()=>[x(G,null,{default:V((()=>[x(J)])),_:1}),l[15]||(l[15]=j(" 新增子组织"))])),_:2},1032,["onClick"]),x(W,{onClick:e=>(async e=>{const a=await $({ID:e.ID});0===a.code&&(p(s.value,e.ID),d.value={ID:a.data.reorg.ID,parentID:a.data.reorg.parentID,name:a.data.reorg.name},r.value="edit",t.value=!0)})(a)},{default:V((()=>[x(G,null,{default:V((()=>[x(ee)])),_:1}),l[16]||(l[16]=j(" 编辑组织"))])),_:2},1032,["onClick"]),x(W,{onClick:e=>(async e=>{E.confirm("确定删除该组织吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1}).then((async()=>{0===(await Y({ID:e.ID})).code&&(K.success("删除成功"),n())})).catch((()=>{K.info("取消删除")}))})(a)},{default:V((()=>[x(G,null,{default:V((()=>[x(ae)])),_:1}),l[17]||(l[17]=j(" 删除组织"))])),_:2},1032,["onClick"])])),_:2},1024)])),default:V((()=>[_("span",Ve,[x(G,null,{default:V((()=>[x(M)])),_:1})])])),_:2},1024)])])])),_:1},8,["data"])])]),_("div",je,[_("div",we,[_("div",Ne,[x(se,{modelValue:Ee.value.userName,"onUpdate:modelValue":l[1]||(l[1]=e=>Ee.value.userName=e),placeholder:"请输入要搜索的用户名"},null,8,["modelValue"]),x(c,{type:"primary",onClick:ye},{default:V((()=>l[18]||(l[18]=[j("搜索")]))),_:1})]),_("div",null,[x(c,{type:"primary",onClick:l[2]||(l[2]=e=>Me())},{default:V((()=>l[19]||(l[19]=[j("更换组织")]))),_:1}),x(c,{type:"primary",onClick:l[3]||(l[3]=e=>Ke(o.value.map((e=>e.sysUser.ID))))},{default:V((()=>l[20]||(l[20]=[j("踢出组织")]))),_:1}),x(c,{type:"primary",onClick:C},{default:V((()=>l[21]||(l[21]=[j("人员入职")]))),_:1})])]),_("div",Ue,[x(qe,{data:ue.value,onSelectionChange:m},{default:V((()=>[x(Te,{type:"selection",width:"55"}),x(Te,{prop:"sysUser.nickName",label:"姓名",width:"120"}),x(Te,{prop:"sysUser.authority.authorityName",label:"用户角色",width:"120"}),x(Te,{prop:"isAdmin",label:"是否管理员",width:"120"},{default:V((({row:e})=>[j(w(e.isAdmin?"是":"否"),1)])),_:1}),x(Te,{label:"操作列","min-width":"220"},{default:V((({row:e})=>[x(c,{link:"",type:"primary",onClick:a=>Me(e.sysUser.ID)},{default:V((()=>l[22]||(l[22]=[j(" 更换组织")]))),_:2},1032,["onClick"]),x(c,{link:"",type:"primary",onClick:a=>Ke([e.sysUser.ID])},{default:V((()=>l[23]||(l[23]=[j(" 踢出组织")]))),_:2},1032,["onClick"]),e.isAdmin?(D(),N(c,{key:1,link:"",type:"primary",onClick:a=>ie(e.sysUser.ID,!1)},{default:V((()=>l[25]||(l[25]=[j(" 取消管理员")]))),_:2},1032,["onClick"])):(D(),N(c,{key:0,link:"",type:"primary",onClick:a=>ie(e.sysUser.ID,!0)},{default:V((()=>l[24]||(l[24]=[j(" 设置管理员")]))),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data"]),_("div",ze,[x(Re,{"current-page":ce.value,"page-size":pe.value,"page-sizes":[10,30,50,100],total:ve.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:me,onSizeChange:fe},null,8,["current-page","page-size","total"])])])])]),x(Qe,{modelValue:t.value,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value=e),"before-close":u,title:"组织管理"},{footer:V((()=>[x(c,{onClick:u},{default:V((()=>l[26]||(l[26]=[j("取消")]))),_:1}),x(c,{type:"primary",onClick:v},{default:V((()=>l[27]||(l[27]=[j("确认")]))),_:1})])),default:V((()=>[x(Fe,{model:d.value,"label-width":"120px"},{default:V((()=>[x(Xe,{label:"父组织"},{default:V((()=>[x(Pe,{modelValue:d.value.parentID,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.parentID=e),data:[{ID:0,name:"根组织"},...s.value],"check-strictly":"",props:a,"render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),x(Xe,{label:"组织名称"},{default:V((()=>[x(se,{modelValue:d.value.name,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.name=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),x(Qe,{modelValue:h.value,"onUpdate:modelValue":l[10]||(l[10]=e=>h.value=e),title:"组织人员"},{footer:V((()=>[x(c,{onClick:Oe},{default:V((()=>l[28]||(l[28]=[j("取消")]))),_:1}),x(c,{type:"primary",onClick:Be},{default:V((()=>l[29]||(l[29]=[j("确定")]))),_:1})])),default:V((()=>[x(Fe,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=e=>k.value=e),"label-width":"120px"},{default:V((()=>[x(Xe,{label:"组织"},{default:V((()=>[x(Pe,{modelValue:k.value.organizationID,"onUpdate:modelValue":l[7]||(l[7]=e=>k.value.organizationID=e),data:[{ID:0,name:"根组织"},...s.value],"check-strictly":"",props:a,"render-after-expand":!1,disabled:""},null,8,["modelValue","data"])])),_:1}),x(Xe,{label:"成员"},{default:V((()=>[x($e,{modelValue:k.value.sysUserIDS,"onUpdate:modelValue":l[8]||(l[8]=e=>k.value.sysUserIDS=e),placeholder:"请选择需要加入组织的成员",multiple:"",filterable:""},{default:V((()=>[(D(!0),I(U,null,z(he.value,(e=>(D(),N(Ze,{key:e.ID,disabled:y.value[e.ID],label:e.nickName,value:e.ID},null,8,["disabled","label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),x(Qe,{modelValue:Ae.value,"onUpdate:modelValue":l[13]||(l[13]=e=>Ae.value=e),title:"更换组织"},{footer:V((()=>[x(c,{onClick:He},{default:V((()=>l[30]||(l[30]=[j("取消")]))),_:1}),x(c,{type:"primary",onClick:Le},{default:V((()=>l[31]||(l[31]=[j("确定")]))),_:1})])),default:V((()=>[x(Fe,{modelValue:Se.value,"onUpdate:modelValue":l[12]||(l[12]=e=>Se.value=e),"label-width":"120px"},{default:V((()=>[x(Xe,{label:"父组织"},{default:V((()=>[x(Pe,{modelValue:Se.value.toOrganizationID,"onUpdate:modelValue":l[11]||(l[11]=e=>Se.value.toOrganizationID=e),data:[{ID:0,name:"根组织"},...s.value],"check-strictly":"",props:a,"render-after-expand":!1},null,8,["modelValue","data"])])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}});export{Ke as default};
