/*! 
 Build based on  
 Time : 1735190558000 */
import{y as e,z as a,A as l,o as t,c as s,b as o,B as n,C as r,D as i,G as c,H as p,I as u,J as d,e as m,n as v,K as f,t as y,f as g,L as b,_ as h,u as C,M as _,a as k,q as w,w as j,g as I,F as x,v as N,h as B,E as D}from"./index.ABWJOL2Q.js";import{E as P,a as R}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                *//* empty css               */import"./scrollbar.3ySweVnY.js";/* empty css            *//* empty css               */import{E as A,a as E}from"./select.C2tLDQ30.js";import{E as V,a as z}from"./descriptions-item.C4J2YVui.js";import{E as T}from"./link.QK3LjIND.js";import{E as G,a as S}from"./breadcrumb-item.DBo9yA-L.js";import{d as M}from"./dayjs.min.DOWqlKAh.js";import{d as q,g as U}from"./applications.GrMV9Sfs.js";import{g as $}from"./pipelines.B5fOuFXJ.js";import{E as O}from"./index.DglrVZRl.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./_Uint8Array.BjvNwsUf.js";import"./_initCloneObject.jmqS1x-g.js";import"./_baseIteratee.BPaQBmlP.js";import"./isEqual.CtpQH3Dm.js";import"./debounce.CkdGDwJt.js";import"./index.6ock-Gvr.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";const Y=e({name:"ImgEmpty"});var F=r(e({...Y,setup(e){const r=a("empty"),i=l();return(e,a)=>(t(),s("svg",{viewBox:"0 0 79 86",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[o("defs",null,[o("linearGradient",{id:"linearGradient-1-".concat(n(i)),x1:"38.8503086%",y1:"0%",x2:"61.1496914%",y2:"100%"},[o("stop",{"stop-color":"var(".concat(n(r).cssVarBlockName("fill-color-1"),")"),offset:"0%"},null,8,["stop-color"]),o("stop",{"stop-color":"var(".concat(n(r).cssVarBlockName("fill-color-4"),")"),offset:"100%"},null,8,["stop-color"])],8,["id"]),o("linearGradient",{id:"linearGradient-2-".concat(n(i)),x1:"0%",y1:"9.5%",x2:"100%",y2:"90.5%"},[o("stop",{"stop-color":"var(".concat(n(r).cssVarBlockName("fill-color-1"),")"),offset:"0%"},null,8,["stop-color"]),o("stop",{"stop-color":"var(".concat(n(r).cssVarBlockName("fill-color-6"),")"),offset:"100%"},null,8,["stop-color"])],8,["id"]),o("rect",{id:"path-3-".concat(n(i)),x:"0",y:"0",width:"17",height:"36"},null,8,["id"])]),o("g",{id:"Illustrations",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[o("g",{id:"B-type",transform:"translate(-1268.000000, -535.000000)"},[o("g",{id:"Group-2",transform:"translate(1268.000000, 535.000000)"},[o("path",{id:"Oval-Copy-2",d:"M39.5,86 C61.3152476,86 79,83.9106622 79,81.3333333 C79,78.7560045 57.3152476,78 35.5,78 C13.6847524,78 0,78.7560045 0,81.3333333 C0,83.9106622 17.6847524,86 39.5,86 Z",fill:"var(".concat(n(r).cssVarBlockName("fill-color-3"),")")},null,8,["fill"]),o("polygon",{id:"Rectangle-Copy-14",fill:"var(".concat(n(r).cssVarBlockName("fill-color-7"),")"),transform:"translate(27.500000, 51.500000) scale(1, -1) translate(-27.500000, -51.500000) ",points:"13 58 53 58 42 45 2 45"},null,8,["fill"]),o("g",{id:"Group-Copy",transform:"translate(34.500000, 31.500000) scale(-1, 1) rotate(-25.000000) translate(-34.500000, -31.500000) translate(7.000000, 10.000000)"},[o("polygon",{id:"Rectangle-Copy-10",fill:"var(".concat(n(r).cssVarBlockName("fill-color-7"),")"),transform:"translate(11.500000, 5.000000) scale(1, -1) translate(-11.500000, -5.000000) ",points:"2.84078316e-14 3 18 3 23 7 5 7"},null,8,["fill"]),o("polygon",{id:"Rectangle-Copy-11",fill:"var(".concat(n(r).cssVarBlockName("fill-color-5"),")"),points:"-3.69149156e-15 7 38 7 38 43 -3.69149156e-15 43"},null,8,["fill"]),o("rect",{id:"Rectangle-Copy-12",fill:"url(#linearGradient-1-".concat(n(i),")"),transform:"translate(46.500000, 25.000000) scale(-1, 1) translate(-46.500000, -25.000000) ",x:"38",y:"7",width:"17",height:"36"},null,8,["fill"]),o("polygon",{id:"Rectangle-Copy-13",fill:"var(".concat(n(r).cssVarBlockName("fill-color-2"),")"),transform:"translate(39.500000, 3.500000) scale(-1, 1) translate(-39.500000, -3.500000) ",points:"24 7 41 7 55 -3.63806207e-12 38 -3.63806207e-12"},null,8,["fill"])]),o("rect",{id:"Rectangle-Copy-15",fill:"url(#linearGradient-2-".concat(n(i),")"),x:"13",y:"45",width:"40",height:"36"},null,8,["fill"]),o("g",{id:"Rectangle-Copy-17",transform:"translate(53.000000, 45.000000)"},[o("use",{id:"Mask",fill:"var(".concat(n(r).cssVarBlockName("fill-color-8"),")"),transform:"translate(8.500000, 18.000000) scale(-1, 1) translate(-8.500000, -18.000000) ","xlink:href":"#path-3-".concat(n(i))},null,8,["fill","xlink:href"]),o("polygon",{id:"Rectangle-Copy",fill:"var(".concat(n(r).cssVarBlockName("fill-color-9"),")"),mask:"url(#mask-4-".concat(n(i),")"),transform:"translate(12.000000, 9.000000) scale(-1, 1) translate(-12.000000, -9.000000) ",points:"7 0 24 0 20 18 7 16.5"},null,8,["fill","mask"])]),o("polygon",{id:"Rectangle-Copy-18",fill:"var(".concat(n(r).cssVarBlockName("fill-color-2"),")"),transform:"translate(66.000000, 51.500000) scale(-1, 1) translate(-66.000000, -51.500000) ",points:"62 45 79 45 70 58 53 58"},null,8,["fill"])])])])]))}}),[["__file","img-empty.vue"]]);const H=i({image:{type:String,default:""},imageSize:Number,description:{type:String,default:""}}),Z=e({name:"ElEmpty"});const L=b(r(e({...Z,props:H,setup(e){const l=e,{t:r}=c(),i=a("empty"),b=p((()=>l.description||r("el.table.emptyText"))),h=p((()=>({width:u(l.imageSize)})));return(e,a)=>(t(),s("div",{class:v(n(i).b())},[o("div",{class:v(n(i).e("image")),style:f(n(h))},[e.image?(t(),s("img",{key:0,src:e.image,ondragstart:"return false"},null,8,["src"])):d(e.$slots,"image",{key:1},(()=>[m(F)]))],6),o("div",{class:v(n(i).e("description"))},[e.$slots.description?d(e.$slots,"description",{key:0}):(t(),s("p",{key:1},y(n(b)),1))],2),e.$slots.default?(t(),s("div",{key:0,class:v(n(i).e("bottom"))},[d(e.$slots,"default")],2)):g("v-if",!0)],2))}}),[["__file","empty.vue"]])),J={class:"app-detail"},K={class:"app-title"},Q={class:"env-header"},W={class:"env-buttons"},X={class:"pipeline-header"},ee=h({__name:"detail",setup(e){const a=C(),l=_().query.id,n=k({}),r=k([]),i=k([]),c=k([]),p=k(""),u=()=>{a.push({name:"applications"})},d=e=>e.status,v=k([]),f=async e=>{F.value=e},g=()=>{},b=async()=>{try{const e=await $({appCode:n.value.appCode,envCode:F.value,cluster_id:h.value,namespace:ae.value});if(0===e.code&&e.data&&0!==Object.keys(e.data).length){const a={...e.data,last_run_time:e.data.last_run_time.replace(/([+\-]\d{4} )?[A-Za-z]{3}$/,"")};i.value=[a]}else i.value=[]}catch(e){}},h=k(),Y=async e=>{if(!e)return;h.value=e;const a={cluster_id:e,app_code:"app=".concat(n.value.appCode,"-").concat(F.value)},l=e=>{if(!e)return"Invalid Date";const a=new Date(e);return isNaN(a.getTime())?"Invalid Date":a.toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"})};try{const e=await U(a);0===e.code&&e.data&&e.data.items&&(ee.value=e.data.items.map((e=>{var a,t,s,o,n,r,i,c;return{instanceID:e.metadata.name,hostIP:e.status.hostIP,containerIP:e.status.podIP,rebootCount:(null==(a=e.status.containerStatuses[0])?void 0:a.restartCount)||0,createdAt:e.metadata.creationTimestamp?l(e.metadata.creationTimestamp):"Invalid Date",version:(null==(t=e.status.containerStatuses[0])?void 0:t.image.split(":")[1])||"Unknown",status:e.status.phase,resources:"".concat(null!=(n=null==(o=null==(s=e.spec.containers[0])?void 0:s.resources.requests)?void 0:o.cpu)?n:"-"," CPU / ").concat(null!=(c=null==(i=null==(r=e.spec.containers[0])?void 0:r.resources.requests)?void 0:i.memory)?c:"-"," RAM")}})))}catch(t){}},F=k(""),H=async e=>{if(F.value=e,!n.value.envs||0===n.value.envs.length)return;const a=n.value.envs.find((a=>a.envCode===e));a&&(ae.value=a.namespace,await Y(a.clusterId),await b())},Z=()=>{a.push({name:"createPipeline",query:{appId:l,envCode:F.value}})},ee=k([]),ae=k("");return w((async()=>{var e,a;try{if(await(async()=>{var e;try{const a=await q(l);if(0===a.code){const l=a.data;n.value={name:l.name||"-",gitRepo:l.gitRepo||"-",branch:l.branch||"main",appName:l.appName||"-",appCode:l.appCode||"-",appDesc:l.appDesc||"-",language:l.language||"未知",appType:l.appType||"无状态应用",deploymentType:l.deploymentType||"容器部署",createdAt:l.CreatedAt||"-",monitorEnabled:l.monitorEnabled||!1,owners:l.owner||[],developers:l.develop||[],envs:l.envs||[]},c.value=(l.envs||[]).map((e=>({envCode:e.envCode,envName:e.envName}))),c.value.length>0?(p.value=(null==(e=c.value[0])?void 0:e.envCode)||"",r.value=l.envs||[]):(p.value="",r.value=[])}else n.value={},c.value=[],p.value="",r.value=[]}catch(a){n.value={},c.value=[],p.value="",r.value=[]}})(),(null==(e=n.value.envs)?void 0:e.length)>0){const e=null==(a=c.value[0])?void 0:a.envCode;F.value=e;const l=n.value.envs.find((a=>a.envCode===e));ae.value=l.namespace,(null==l?void 0:l.clusterId)&&await Y(l.clusterId)}const t=await(async()=>new Promise((e=>{setTimeout((()=>{e([{instanceID:"inst-001",hostIP:"192.168.1.100",containerIP:"10.0.0.1",rebootCount:2,createdAt:"2024-11-19T12:34:56",version:"v1.0.0",status:"Running",resources:"2 CPUs / 4 GB RAM"},{instanceID:"inst-002",hostIP:"192.168.1.101",containerIP:"10.0.0.2",rebootCount:1,createdAt:"2024-11-18T11:30:00",version:"v1.1.0",status:"Stopped",resources:"4 CPUs / 8 GB RAM"}])}),.001)})))();v.value=t,await b()}catch(t){}})),(e,a)=>{const l=G,r=S,b=T,h=V,C=O,_=z,k=A,w=E,q=D,U=P,$=R,Y=L;return t(),s("div",J,[m(r,{separator:"/"},{default:j((()=>[m(l,{onClick:u,style:{cursor:"pointer",color:"#409EFF"}},{default:j((()=>a[1]||(a[1]=[I("我的应用")]))),_:1}),m(l,null,{default:j((()=>a[2]||(a[2]=[I("应用详情")]))),_:1})])),_:1}),o("h2",K,y(n.value.name),1),a[9]||(a[9]=o("h3",{class:"section-title"},"应用概要",-1)),m(_,{column:4,border:""},{default:j((()=>[m(h,{label:"代码仓库"},{default:j((()=>[m(b,{href:n.value.gitRepo,target:"_blank"},{default:j((()=>[I(y(n.value.gitRepo),1)])),_:1},8,["href"])])),_:1}),m(h,{label:"主干分支"},{default:j((()=>[I(y(n.value.branch),1)])),_:1}),m(h,{label:"应用 Owner"},{default:j((()=>[(t(!0),s(x,null,N(n.value.owners,(e=>(t(),B(C,{key:e.ID,size:"small",type:"info"},{default:j((()=>[I(y(e.label),1)])),_:2},1024)))),128))])),_:1}),m(h,{label:"应用开发"},{default:j((()=>[(t(!0),s(x,null,N(n.value.developers,(e=>(t(),B(C,{key:e.ID,size:"small",type:"success"},{default:j((()=>[I(y(e.label),1)])),_:2},1024)))),128))])),_:1}),m(h,{label:"应用名称"},{default:j((()=>[I(y(n.value.appName),1)])),_:1}),m(h,{label:"应用标识"},{default:j((()=>[I(y(n.value.appCode),1)])),_:1}),m(h,{label:"应用描述"},{default:j((()=>[I(y(n.value.appDesc||"-"),1)])),_:1}),m(h,{label:"程序开发语言"},{default:j((()=>[I(y(n.value.language),1)])),_:1}),m(h,{label:"应用类型"},{default:j((()=>[I(y(n.value.appType||"-"),1)])),_:1}),m(h,{label:"部署类型"},{default:j((()=>[I(y(n.value.deploymentType),1)])),_:1}),m(h,{label:"创建时间"},{default:j((()=>{return[I(y((e=n.value.createdAt,e?M(e).format("YYYY-MM-DD HH:mm:ss"):"-")),1)];var e})),_:1}),m(h,{label:"应用监控"},{default:j((()=>[I(y(n.value.monitorEnabled?"已接入":"未接入"),1)])),_:1})])),_:1}),o("div",Q,[m(w,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),onChange:H,placeholder:"请选择环境",size:"small",style:{width:"200px"}},{default:j((()=>[(t(!0),s(x,null,N(c.value,(e=>(t(),B(k,{key:e.envCode,label:e.envName,value:e.envCode},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),o("div",W,[m(q,{type:"primary",size:"small",onClick:f},{default:j((()=>a[3]||(a[3]=[I("刷新")]))),_:1}),m(q,{type:"danger",size:"small",plain:"",onClick:g},{default:j((()=>a[4]||(a[4]=[I("伸缩策略配置")]))),_:1})])]),a[10]||(a[10]=o("h3",{class:"section-title"},"部署信息",-1)),v.value.length>0?(t(),B($,{key:0,data:ee.value,class:"deploy-table",style:{width:"100%"},border:""},{default:j((()=>[m(U,{prop:"instanceID",label:"实例 ID"}),m(U,{prop:"hostIP",label:"宿主机 IP"}),m(U,{prop:"containerIP",label:"容器 IP"}),m(U,{prop:"rebootCount",label:"重启次数"}),m(U,{prop:"createdAt",label:"创建时间"}),m(U,{prop:"version",label:"版本"}),m(U,{prop:"status",label:"状态"}),m(U,{label:"操作"},{default:j((e=>[m(q,{type:"text",size:"small",onClick:a=>{e.row}},{default:j((()=>a[5]||(a[5]=[I("操作")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):(t(),B(Y,{key:1,description:"暂无环境数据"})),o("div",X,[a[7]||(a[7]=o("h3",{class:"section-title"},"流水线",-1)),m(q,{size:"small",type:"primary",class:"create-pipeline-button",icon:"el-icon-s-operation",onClick:Z},{default:j((()=>a[6]||(a[6]=[I(" 创建流水线 ")]))),_:1})]),i.value.length>0?(t(),B($,{key:2,data:i.value,class:"pipeline-table",style:{width:"100%"},border:""},{default:j((()=>[m(U,{prop:"status",label:"运行状态"},{default:j((e=>[m(C,{type:"Succeeded"===d(e.row)?"success":"danger"},{default:j((()=>[I(y(d(e.row)),1)])),_:2},1032,["type"])])),_:1}),m(U,{prop:"user",label:"运行人"}),m(U,{prop:"branch",label:"分支"}),m(U,{prop:"last_run_time",label:"最近运行时间"}),m(U,{prop:"duration",label:"耗时"}),m(U,{label:"操作"},{default:j((e=>[m(q,{type:"text",size:"small",onClick:a=>{e.row}},{default:j((()=>a[8]||(a[8]=[I("操作")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):(t(),B(Y,{key:3,description:"暂无流水线数据"}))])}}},[["__scopeId","data-v-30e2df78"]]);export{ee as default};
