/*! 
 Build based on  
 Time : 1735190558000 */
import{_ as e,a,q as l,o as t,h as s,w as i,e as n,c as r,b as o,t as d,a1 as c,k as u}from"./index.ABWJOL2Q.js";import{c as m,a as p,b as f}from"./main.Bbq1dHus.js";/* empty css             */import"./checkbox.BcMUmSPv.js";/* empty css              */import{g as h}from"./cmdbProjects.CXcaQTcF.js";import{g as v,T as g}from"./cmdbHosts.BvNxdKUP.js";import{x as b}from"./xterm.BR7SOqRe.js";/* empty css              */import{E as j}from"./index.HOewoZCo.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./token.DWNpOE8r.js";import"./index.gYVODlrW.js";const x={key:0},y={key:1},k=e({__name:"terminalPage",setup(e){const k=a([]),w=a(""),_=a([]),I=a(null);let L=null,z=null,D="";const E={children:"children",label:"label",isLeaf:"isLeaf"},H=async(e,a)=>{if(0===e.level)a(k.value);else if(1===e.level){const l=await v({page:1,pageSize:100,project:e.data.id});if(0===l.code){a(l.data.list.map((e=>({id:e.ID,label:e.serverHost,isLeaf:!0}))))}else a([])}},P=e=>{e.isLeaf&&(I.value={ip:e.label},c((()=>{const a=window.innerHeight-140;z||(z=new b.Terminal({rows:parseInt(a/17,10),cols:200,cursorStyle:"block",cursorBlink:!0,scrollback:1e3,theme:{background:"#000000",foreground:"#ffffff"}}),z.open(document.getElementById("terminal"))),z.clear(),L=g(e.label,(e=>{const a=e.replace(/\r?\n/g,"\r\n");z.write(a)})),z.onData((e=>{"\r"===e?(z.write("\r\n"),L.sendCommand(D+"\n"),D=""):""===e?D.length>0&&(D=D.slice(0,-1),z.write("\b \b")):(D+=e,z.write(e))}))})))},S=()=>{if(w.value){const e=e=>e.label.includes(w.value),a=l=>l.map((l=>{const t=l.children?a(l.children):[];if(e(l)||t.length)return{...l,children:t}})).filter((e=>e));_.value=a(k.value)}else _.value=k.value};return l((()=>{(async()=>{const e=await h({page:1,pageSize:100});0===e.code&&(k.value=e.data.list.map((e=>({id:e.ID,label:e.name,children:[],isLeaf:!1}))),_.value=k.value)})()})),(e,a)=>{const l=u,c=j,h=m,v=p,g=f;return t(),s(g,{style:{height:"100vh"}},{default:i((()=>[n(h,{width:"300px",class:"aside-hosts"},{default:i((()=>[n(l,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),placeholder:"搜索主机 IP",onInput:S,clearable:"",class:"search-input"},null,8,["modelValue"]),n(c,{data:_.value,props:E,"node-key":"id","highlight-current":"",onNodeClick:P,"expand-on-click-node":!1,load:H,lazy:"",class:"host-tree"},null,8,["data"])])),_:1}),n(g,{style:{height:"100%"}},{default:i((()=>[n(v,{style:{padding:"0",display:"flex","flex-direction":"column",height:"100%"}},{default:i((()=>[I.value?(t(),r("div",x,[o("p",null,"正在连接到 "+d(I.value.ip)+"...",1),a[1]||(a[1]=o("div",{id:"terminal",class:"terminal-output"},null,-1))])):(t(),r("div",y,a[2]||(a[2]=[o("p",null,"请选择一个主机进行连接",-1)])))])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-19adfc07"]]);export{k as default};
