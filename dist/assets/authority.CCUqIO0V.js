/*! 
 Build based on  
 Time : 1735190558000 */
import{a as e,o as a,c as t,e as l,b as o,w as r,g as i,t as u,h as d,f as s,cu as n,i as m,E as p,k as y}from"./index.ABWJOL2Q.js";import{E as h,a as c}from"./tab-pane.fs024GHS.js";import{E as v}from"./drawer.XhtctEYG.js";import"./overlay.CDLw2uOw.js";/* empty css             *//* empty css              */import{a as f,E as j}from"./form-item.ujPiwBAF.js";import{E as I}from"./cascader-panel.BQdm0Z6T.js";/* empty css               *//* empty css            */import"./checkbox.BcMUmSPv.js";/* empty css              */import"./scrollbar.3ySweVnY.js";import{E as b,a as g}from"./table-column.ChuwY-lb.js";/* empty css                *//* empty css               */import{g as w,d as k,c as _,u as C,a as x}from"./authority.Ckl6dsTi.js";import N from"./menus.CPyBnIiJ.js";import V from"./apis.QXxbxxMJ.js";import E from"./datas.VdnT4pT9.js";import{_ as A}from"./warningBar.BzThqhMC.js";import"./strings.C2tuonvC.js";import"./index.C5gbd99D.js";import"./index.BRjlB3m5.js";import"./index.D4uEcQv3.js";import"./castArray.9wqFpW2Z.js";import"./_baseClone.gl1e0kmI.js";import"./_Uint8Array.BjvNwsUf.js";import"./_initCloneObject.jmqS1x-g.js";import"./index.DINKPDpR.js";import"./isEqual.CtpQH3Dm.js";import"./arrays.CvpzyGiz.js";import"./cloneDeep.BwH6oqGn.js";import"./index.DglrVZRl.js";import"./index.6ock-Gvr.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./dialog.DdLHJsLF.js";import"./refs.CZv2DkwS.js";/* empty css             */import"./authorityBtn.CNV2FmNx.js";import"./index.HOewoZCo.js";import"./token.DWNpOE8r.js";import"./index.gYVODlrW.js";import"./api.CmojoYCN.js";/* empty css                       */const U={class:"authority"},D={class:"dycloud-table-box"},q={class:"dycloud-btn-list"},B={class:"flex justify-between items-center"},R={class:"text-lg"},S=Object.assign({name:"Authority"},{__name:"authority",setup(S){const F=e([{authorityId:0,authorityName:"根角色/严格模式下为当前角色"}]),O=e(!1),P=e("add"),T=e({}),z=e("新增角色"),H=e(!1),Q=e(!1),W=e({}),Y=e({authorityId:0,authorityName:"",parentId:0}),Z=e({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),$=e([]),G=async()=>{const e=await w();0===e.code&&($.value=e.data)};G();const J=(e,a)=>{T.value[e]=a},K=e(null),L=e(null),M=e(null),X=(e,a)=>{const t=[K,L,M];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},ee=e(null),ae=()=>{ee.value&&ee.value.resetFields(),Y.value={authorityId:0,authorityName:"",parentId:0}},te=()=>{ae(),H.value=!1,Q.value=!1},le=()=>{ee.value.validate((async e=>{if(e){switch(Y.value.authorityId=Number(Y.value.authorityId),P.value){case"add":0===(await x(Y.value)).code&&(m({type:"success",message:"添加成功!"}),G(),te());break;case"edit":0===(await C(Y.value)).code&&(m({type:"success",message:"添加成功!"}),G(),te());break;case"copy":{const e={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};e.authority.authorityId=Y.value.authorityId,e.authority.authorityName=Y.value.authorityName,e.authority.parentId=Y.value.parentId,e.authority.dataAuthorityId=W.value.dataAuthorityId,e.oldAuthorityId=W.value.authorityId;0===(await _(e)).code&&(m({type:"success",message:"复制成功！"}),G())}}ae(),H.value=!1}}))},oe=()=>{F.value=[{authorityId:0,authorityName:"根角色(严格模式下为当前用户角色)"}],re($.value,F.value,!1)},re=(e,a,t)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===Y.value.authorityId,children:[]};re(e.children,l.children,t||e.authorityId===Y.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===Y.value.authorityId};a.push(l)}}))},ie=e=>{ae(),z.value="新增角色",P.value="add",Y.value.parentId=e,oe(),H.value=!0};return(e,w)=>{const _=p,C=b,x=g,S=I,Q=f,ae=y,re=j,ue=v,de=h,se=c;return a(),t("div",U,[l(A,{title:"注：右上角头像下拉可切换角色"}),o("div",D,[o("div",q,[l(_,{type:"primary",icon:"plus",onClick:w[0]||(w[0]=e=>ie(0))},{default:r((()=>w[6]||(w[6]=[i("新增角色")]))),_:1})]),l(x,{data:$.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(C,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(C,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(C,{align:"left",label:"操作",width:"460"},{default:r((e=>[l(_,{icon:"setting",type:"primary",link:"",onClick:a=>{return t=e.row,O.value=!0,void(T.value=t);var t}},{default:r((()=>w[7]||(w[7]=[i("设置权限")]))),_:2},1032,["onClick"]),l(_,{icon:"plus",type:"primary",link:"",onClick:a=>ie(e.row.authorityId)},{default:r((()=>w[8]||(w[8]=[i("新增子角色")]))),_:2},1032,["onClick"]),l(_,{icon:"copy-document",type:"primary",link:"",onClick:a=>(e=>{oe(),z.value="拷贝角色",P.value="copy";for(const a in Y.value)Y.value[a]=e[a];W.value=e,H.value=!0})(e.row)},{default:r((()=>w[9]||(w[9]=[i("拷贝")]))),_:2},1032,["onClick"]),l(_,{icon:"edit",type:"primary",link:"",onClick:a=>(e=>{oe(),z.value="编辑角色",P.value="edit";for(const a in Y.value)Y.value[a]=e[a];oe(),ee.value&&ee.value.clearValidate(),H.value=!0})(e.row)},{default:r((()=>w[10]||(w[10]=[i("编辑")]))),_:2},1032,["onClick"]),l(_,{icon:"delete",type:"primary",link:"",onClick:a=>{return t=e.row,void n.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await k({authorityId:t.authorityId})).code&&(m({type:"success",message:"删除成功!"}),G())})).catch((()=>{m({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>w[11]||(w[11]=[i("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(ue,{modelValue:H.value,"onUpdate:modelValue":w[4]||(w[4]=e=>H.value=e),"show-close":!1},{header:r((()=>[o("div",B,[o("span",R,u(z.value),1),o("div",null,[l(_,{onClick:te},{default:r((()=>w[12]||(w[12]=[i("取 消")]))),_:1}),l(_,{type:"primary",onClick:le},{default:r((()=>w[13]||(w[13]=[i("确 定")]))),_:1})])])])),default:r((()=>[l(re,{ref_key:"authorityForm",ref:ee,model:Y.value,rules:Z.value,"label-width":"80px"},{default:r((()=>[l(Q,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(S,{modelValue:Y.value.parentId,"onUpdate:modelValue":w[1]||(w[1]=e=>Y.value.parentId=e),style:{width:"100%"},disabled:"add"===P.value,options:F.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(Q,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(ae,{modelValue:Y.value.authorityId,"onUpdate:modelValue":w[2]||(w[2]=e=>Y.value.authorityId=e),disabled:"edit"===P.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(Q,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(ae,{modelValue:Y.value.authorityName,"onUpdate:modelValue":w[3]||(w[3]=e=>Y.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),O.value?(a(),d(ue,{key:0,modelValue:O.value,"onUpdate:modelValue":w[5]||(w[5]=e=>O.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(se,{"before-leave":X,type:"border-card"},{default:r((()=>[l(de,{label:"角色菜单"},{default:r((()=>[l(N,{ref_key:"menus",ref:K,row:T.value,onChangeRow:J},null,8,["row"])])),_:1}),l(de,{label:"角色api"},{default:r((()=>[l(V,{ref_key:"apis",ref:L,row:T.value,onChangeRow:J},null,8,["row"])])),_:1}),l(de,{label:"资源权限"},{default:r((()=>[l(E,{ref_key:"datas",ref:M,authority:$.value,row:T.value,onChangeRow:J},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):s("",!0)])}}});export{S as default};
