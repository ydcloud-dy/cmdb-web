/*! 
 Build based on  
 Time : 1735190558000 */
import{a as e,R as a,o as l,c as t,e as o,b as i,w as s,g as r,h as u,f as d,x as n,cu as m,dN as p,i as c,dO as h,dP as g,dQ as v,a1 as y,dR as f,E as b,k as w}from"./index.ABWJOL2Q.js";import{E as j}from"./drawer.XhtctEYG.js";import"./overlay.CDLw2uOw.js";/* empty css             */import{a as I,E as V}from"./form-item.ujPiwBAF.js";/* empty css              */import{E as k}from"./pagination.BfYt3rvk.js";/* empty css            */import"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               */import{E as _,a as x}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                */import{E as N}from"./switch.CqADXIhW.js";import{E as C}from"./cascader-panel.BQdm0Z6T.js";/* empty css              *//* empty css               */import{g as U}from"./authority.Ckl6dsTi.js";import{C as z}from"./index.C4P4C0XU.js";import{_ as D}from"./warningBar.BzThqhMC.js";import{_ as E}from"./selectImage.BKPnAVZM.js";import"./index.BRjlB3m5.js";import"./index.D4uEcQv3.js";import"./castArray.9wqFpW2Z.js";import"./_baseClone.gl1e0kmI.js";import"./_Uint8Array.BjvNwsUf.js";import"./_initCloneObject.jmqS1x-g.js";import"./isEqual.CtpQH3Dm.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./index.DINKPDpR.js";import"./arrays.CvpzyGiz.js";import"./cloneDeep.BwH6oqGn.js";import"./image-viewer.Dd9ZIujV.js";import"./position.DTC6E8em.js";import"./image.CN53lrx2.js";import"./common.CYrLijw_.js";import"./upload.-Ej7EZzx.js";import"./progress.KCbgDfe_.js";const S={class:"dycloud-table-box"},O={class:"dycloud-btn-list"},T={class:"dycloud-pagination"},q={class:"flex justify-between items-center"},B=Object.assign({name:"User"},{__name:"user",setup(B){e("/api/");const J=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};J(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},P=e(1),R=e(0),A=e(10),F=e([]),Q=e=>{A.value=e,Z()},$=e=>{P.value=e,Z()},Z=async()=>{const e=await n({page:P.value,pageSize:A.value});0===e.code&&(F.value=e.data.list,R.value=e.data.total,P.value=e.data.page,A.value=e.data.pageSize)};a((()=>F.value),(()=>{G()}));(async()=>{Z();const e=await U();K(e.data)})();const G=()=>{F.value&&F.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))};e(null);const H=e([]),K=e=>{H.value=[],J(e,H.value)},L=e({userName:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),M=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),W=e(null),X=async()=>{L.value.authorityId=L.value.authorityIds[0],W.value.validate((async e=>{if(e){const e={...L.value};if("add"===ae.value){0===(await g(e)).code&&(c({type:"success",message:"创建成功"}),await Z(),ee())}if("edit"===ae.value){0===(await v(e)).code&&(c({type:"success",message:"编辑成功"}),await Z(),ee())}}}))},Y=e(!1),ee=()=>{W.value.resetFields(),L.value.headerImg="",L.value.authorityIds=[],Y.value=!1},ae=e("add"),le=()=>{ae.value="add",Y.value=!0},te={},oe=async(e,a,l)=>{if(a)return void(l||(te[e.ID]=[...e.authorityIds]));await y();0===(await f({ID:e.ID,authorityIds:e.authorityIds})).code?c({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...te[e.ID]],delete te[e.ID])};return(e,a)=>{const n=b,g=_,f=C,U=N,B=x,J=k,G=w,K=I,te=V,ie=j;return l(),t("div",null,[o(D,{title:"注：右上角头像下拉可切换角色"}),i("div",S,[i("div",O,[o(n,{type:"primary",icon:"plus",onClick:le},{default:s((()=>a[9]||(a[9]=[r("新增用户")]))),_:1})]),o(B,{data:F.value,"row-key":"ID"},{default:s((()=>[o(g,{align:"left",label:"头像","min-width":"75"},{default:s((e=>[o(z,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),o(g,{align:"left",label:"ID","min-width":"50",prop:"ID"}),o(g,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),o(g,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),o(g,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),o(g,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),o(g,{align:"left",label:"用户角色","min-width":"200"},{default:s((e=>[o(f,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:H.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{oe(e.row,a,0)},onRemoveTag:a=>{oe(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),o(g,{align:"left",label:"启用","min-width":"150"},{default:s((e=>[o(U,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{L.value=JSON.parse(JSON.stringify(e)),await y();const a={...L.value};0===(await v(a)).code&&(c({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await Z(),L.value.headerImg="",L.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),o(g,{label:"操作","min-width":"250",fixed:"right"},{default:s((e=>[o(n,{type:"primary",link:"",icon:"delete",onClick:a=>(async e=>{m.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await h({id:e.ID})).code&&(c.success("删除成功"),await Z())}))})(e.row)},{default:s((()=>a[10]||(a[10]=[r("删除")]))),_:2},1032,["onClick"]),o(n,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,ae.value="edit",L.value=JSON.parse(JSON.stringify(l)),void(Y.value=!0);var l}},{default:s((()=>a[11]||(a[11]=[r("编辑")]))),_:2},1032,["onClick"]),o(n,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void m.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await p({ID:l.ID});0===e.code?c({type:"success",message:e.msg}):c({type:"error",message:e.msg})}));var l}},{default:s((()=>a[12]||(a[12]=[r("重置密码")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),i("div",T,[o(J,{"current-page":P.value,"page-size":A.value,"page-sizes":[10,30,50,100],total:R.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:$,onSizeChange:Q},null,8,["current-page","page-size","total"])])]),o(ie,{modelValue:Y.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Y.value=e),size:"60%","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{header:s((()=>[i("div",q,[a[15]||(a[15]=i("span",{class:"text-lg"},"用户",-1)),i("div",null,[o(n,{onClick:ee},{default:s((()=>a[13]||(a[13]=[r("取 消")]))),_:1}),o(n,{type:"primary",onClick:X},{default:s((()=>a[14]||(a[14]=[r("确 定")]))),_:1})])])])),default:s((()=>[o(te,{ref_key:"userForm",ref:W,rules:M.value,model:L.value,"label-width":"80px"},{default:s((()=>["add"===ae.value?(l(),u(K,{key:0,label:"用户名",prop:"userName"},{default:s((()=>[o(G,{modelValue:L.value.userName,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value.userName=e)},null,8,["modelValue"])])),_:1})):d("",!0),"add"===ae.value?(l(),u(K,{key:1,label:"密码",prop:"password"},{default:s((()=>[o(G,{modelValue:L.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>L.value.password=e)},null,8,["modelValue"])])),_:1})):d("",!0),o(K,{label:"昵称",prop:"nickName"},{default:s((()=>[o(G,{modelValue:L.value.nickName,"onUpdate:modelValue":a[2]||(a[2]=e=>L.value.nickName=e)},null,8,["modelValue"])])),_:1}),o(K,{label:"手机号",prop:"phone"},{default:s((()=>[o(G,{modelValue:L.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value.phone=e)},null,8,["modelValue"])])),_:1}),o(K,{label:"邮箱",prop:"email"},{default:s((()=>[o(G,{modelValue:L.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value.email=e)},null,8,["modelValue"])])),_:1}),o(K,{label:"用户角色",prop:"authorityId"},{default:s((()=>[o(f,{modelValue:L.value.authorityIds,"onUpdate:modelValue":a[5]||(a[5]=e=>L.value.authorityIds=e),style:{width:"100%"},options:H.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),o(K,{label:"启用",prop:"disabled"},{default:s((()=>[o(U,{modelValue:L.value.enable,"onUpdate:modelValue":a[6]||(a[6]=e=>L.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),o(K,{label:"头像","label-width":"80px"},{default:s((()=>[o(E,{modelValue:L.value.headerImg,"onUpdate:modelValue":a[7]||(a[7]=e=>L.value.headerImg=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])])}}});export{B as default};
