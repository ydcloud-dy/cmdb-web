/*! 
 Build based on  
 Time : 1735190558000 */
import{a as e,r as a,P as l,o as t,c as r,b as s,e as o,w as u,g as d,F as i,f as n,h as p,m as c,t as m,B as v,U as f,de as y,v as b,cu as g,i as C,Q as k,E as h,k as _}from"./index.ABWJOL2Q.js";import{E as w}from"./drawer.XhtctEYG.js";import"./overlay.CDLw2uOw.js";import{E as V}from"./switch.CqADXIhW.js";/* empty css            */import{E as j,a as A}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              */import{E as T}from"./pagination.BfYt3rvk.js";import{E as x,a as E}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                */import{E as U}from"./link.QK3LjIND.js";/* empty css             *//* empty css               */import{a as S,E as I}from"./form-item.ujPiwBAF.js";import{E as P}from"./date-picker.CCiP3Fyg.js";import{g as z,d as D,f as K,a as B,c as F,u as q,b as L}from"./host.9Piocw2G.js";import{E as Q}from"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_initCloneObject.jmqS1x-g.js";import"./_baseClone.gl1e0kmI.js";import"./dayjs.min.DOWqlKAh.js";import"./arrays.CvpzyGiz.js";import"./index.7ugBSK5z.js";const M={class:"dycloud-search-box"},O={class:"dycloud-table-box"},R={class:"dycloud-btn-list"},H={class:"dycloud-pagination"},G={class:"flex justify-between items-center"},J={class:"text-lg"},N=Object.assign({name:"Host"},{__name:"host",setup(N){const W=e(!1),X=e({name:"",description:"",enableTls:!1,tlsCa:"",tlsCert:"",tlsKey:"",skipCert:!1,apiAddress:"",port:2375,type:1}),Y=a({socketPath:[{required:!0,message:"",trigger:["input","blur"]}],name:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],apiAddress:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],enableTls:[{required:!0,message:"",trigger:["input","blur"]}]}),Z=a({createdAt:[{validator:(e,a,l)=>{se.value.startCreatedAt&&!se.value.endCreatedAt?l(new Error("请填写结束日期")):!se.value.startCreatedAt&&se.value.endCreatedAt?l(new Error("请填写开始日期")):se.value.startCreatedAt&&se.value.endCreatedAt&&(se.value.startCreatedAt.getTime()===se.value.endCreatedAt.getTime()||se.value.startCreatedAt.getTime()>se.value.endCreatedAt.getTime())?l(new Error("开始日期应当早于结束日期")):l()},trigger:"change"}]}),$=e(),ee=e(),ae=e(1),le=e(0),te=e(10),re=e([]),se=e({}),oe=()=>{se.value={},ne()},ue=()=>{var e;null==(e=ee.value)||e.validate((async e=>{e&&(ae.value=1,te.value=10,""===se.value.enableTls&&(se.value.enableTls=null),""===se.value.skipCert&&(se.value.skipCert=null),ne())}))},de=e=>{te.value=e,ne()},ie=e=>{ae.value=e,ne()},ne=async()=>{const e=await z({page:ae.value,pageSize:te.value,...se.value});0===e.code&&(re.value=e.data.list,le.value=e.data.total,ae.value=e.data.page,te.value=e.data.pageSize)};ne();(async()=>{})();const pe=e([]),ce=e=>{pe.value=e},me=async()=>{g.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=[];if(0===pe.value.length)return void C({type:"warning",message:"请选择要删除的数据"});pe.value&&pe.value.map((a=>{e.push(a.ID)}));0===(await D({IDs:e})).code&&(C({type:"success",message:"删除成功"}),re.value.length===e.length&&ae.value>1&&ae.value--,ne())}))},ve=e(""),fe=async e=>{0===(await B({ID:e.ID})).code&&(C({type:"success",message:"删除成功"}),1===re.value.length&&ae.value>1&&ae.value--,ne())},ye=e(!1),be=()=>{ve.value="create",ye.value=!0},ge=()=>{ye.value=!1,X.value={name:"",description:"",enableTls:!1,tlsCa:"",tlsCert:"",tlsKey:"",skipCert:!1,apiAddress:"",port:0}},Ce=async()=>{var e;null==(e=$.value)||e.validate((async e=>{if(!e)return;let a;switch(ve.value){case"create":default:a=await F(X.value);break;case"update":a=await q(X.value)}0===a.code&&(C({type:"success",message:"创建/更改成功"}),ge(),ne())}))},ke=e("/api");e("");const he=e([{label:"socket",value:0},{label:"api",value:1}]),_e=async e=>{if(0===e.type&&""===e.socketPath)return void C({type:"error",message:"socketPath 参数不能为空"});if(1===e.type){if(""===e.apiAddress)return void C({type:"error",message:"API地址不能为空"});if(0===e.port)return void C({type:"error",message:"API端口不能为空"})}const a=await L(e);0===a.code&&(a.data.success?C({type:"success",message:"测试主机成功"}):C({type:"error",message:a.msg}))};return(e,a)=>{const C=l("QuestionFilled"),z=k,D=Q,B=P,F=S,q=h,L=I,N=U,ne=x,we=E,Ve=T,je=_,Ae=j,Te=A,xe=V,Ee=w;return t(),r("div",null,[s("div",M,[o(L,{ref_key:"elSearchFormRef",ref:ee,inline:!0,model:se.value,class:"demo-form-inline",rules:Z,onKeyup:c(ue,["enter"])},{default:u((()=>[o(F,{label:"创建日期",prop:"createdAt"},{label:u((()=>[s("span",null,[a[17]||(a[17]=d(" 创建日期 ")),o(D,{content:"搜索范围是开始日期（包含）至结束日期（不包含）"},{default:u((()=>[o(z,null,{default:u((()=>[o(C)])),_:1})])),_:1})])])),default:u((()=>[o(B,{modelValue:se.value.startCreatedAt,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value.startCreatedAt=e),type:"datetime",placeholder:"开始日期","disabled-date":e=>!!se.value.endCreatedAt&&e.getTime()>se.value.endCreatedAt.getTime()},null,8,["modelValue","disabled-date"]),a[18]||(a[18]=d(" — ")),o(B,{modelValue:se.value.endCreatedAt,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value.endCreatedAt=e),type:"datetime",placeholder:"结束日期","disabled-date":e=>!!se.value.startCreatedAt&&e.getTime()<se.value.startCreatedAt.getTime()},null,8,["modelValue","disabled-date"])])),_:1}),W.value?(t(),r(i,{key:0},[],64)):n("",!0),o(F,null,{default:u((()=>[o(q,{type:"primary",icon:"search",onClick:ue},{default:u((()=>a[19]||(a[19]=[d("查询")]))),_:1}),o(q,{icon:"refresh",onClick:oe},{default:u((()=>a[20]||(a[20]=[d("重置")]))),_:1}),W.value?(t(),p(q,{key:1,type:"text",icon:"arrow-up",onClick:a[3]||(a[3]=e=>W.value=!1)},{default:u((()=>a[22]||(a[22]=[d("收起")]))),_:1})):(t(),p(q,{key:0,type:"text",icon:"arrow-down",onClick:a[2]||(a[2]=e=>W.value=!0)},{default:u((()=>a[21]||(a[21]=[d("展开")]))),_:1}))])),_:1})])),_:1},8,["model","rules"])]),s("div",O,[s("div",R,[o(q,{type:"primary",icon:"plus",onClick:be},{default:u((()=>a[23]||(a[23]=[d("新增")]))),_:1}),o(q,{icon:"delete",style:{"margin-left":"10px"},disabled:!pe.value.length,onClick:me},{default:u((()=>a[24]||(a[24]=[d("删除")]))),_:1},8,["disabled"]),o(N,{style:{"margin-left":"20px"},icon:"download",href:ke.value+"/docker/host/genTlsScript"},{default:u((()=>a[25]||(a[25]=[d("生成SSL证书脚本")]))),_:1},8,["href"])]),o(we,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:re.value,"row-key":"ID",onSelectionChange:ce},{default:u((()=>[o(ne,{type:"selection",width:"55"}),o(ne,{align:"left",label:"日期",prop:"createdAt",width:"180"},{default:u((e=>[d(m(v(f)(e.row.CreatedAt)),1)])),_:1}),o(ne,{align:"left",label:"主机名称",prop:"name",width:"120"}),o(ne,{align:"left",label:"连接类型",prop:"type",width:"120"},{default:u((e=>[d(m(e.row.type),1)])),_:1}),o(ne,{align:"left",label:"主机描述",prop:"description",width:"120"}),o(ne,{align:"left",label:"开启tls",prop:"enableTls",width:"120"},{default:u((e=>[d(m(v(y)(e.row.enableTls)),1)])),_:1}),o(ne,{align:"left",label:"跳过安全证书",prop:"skipCert",width:"120"},{default:u((e=>[d(m(v(y)(e.row.skipCert)),1)])),_:1}),o(ne,{align:"left",label:"访问地址",prop:"apiAddress",width:"120"}),o(ne,{align:"left",label:"访问端口",prop:"port",width:"120"}),o(ne,{align:"left",label:"操作",fixed:"right","min-width":"240"},{default:u((e=>[o(q,{type:"primary",link:"",class:"table-button",onClick:a=>_e(e.row)},{default:u((()=>a[26]||(a[26]=[d("测试连接")]))),_:2},1032,["onClick"]),o(q,{type:"primary",link:"",icon:"edit",class:"table-button",onClick:a=>(async e=>{const a=await K({ID:e.ID});ve.value="update",0===a.code&&(X.value=a.data.rehs,ye.value=!0)})(e.row)},{default:u((()=>a[27]||(a[27]=[d("变更")]))),_:2},1032,["onClick"]),o(q,{type:"primary",link:"",icon:"delete",onClick:a=>{return l=e.row,void g.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{fe(l)}));var l}},{default:u((()=>a[28]||(a[28]=[d("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),s("div",H,[o(Ve,{layout:"total, sizes, prev, pager, next, jumper","current-page":ae.value,"page-size":te.value,"page-sizes":[10,30,50,100],total:le.value,onCurrentChange:ie,onSizeChange:de},null,8,["current-page","page-size","total"])])]),o(Ee,{"destroy-on-close":"",size:"800",modelValue:ye.value,"onUpdate:modelValue":a[16]||(a[16]=e=>ye.value=e),"show-close":!1,"before-close":ge},{header:u((()=>[s("div",G,[s("span",J,m("create"===ve.value?"添加":"修改"),1),s("div",null,[o(q,{type:"primary",onClick:Ce},{default:u((()=>a[29]||(a[29]=[d("确 定")]))),_:1}),o(q,{onClick:ge},{default:u((()=>a[30]||(a[30]=[d("取 消")]))),_:1})])])])),default:u((()=>[o(L,{model:X.value,"label-position":"left",ref_key:"elFormRef",ref:$,rules:Y,"label-width":"200px"},{default:u((()=>[o(F,{label:"主机名称:",prop:"name"},{default:u((()=>[o(je,{modelValue:X.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>X.value.name=e),clearable:!0,placeholder:"请输入主机名称,示例: test 使用小写英文"},null,8,["modelValue"])])),_:1}),o(F,{label:"主机类型:",prop:"type"},{default:u((()=>[o(Te,{modelValue:X.value.type,"onUpdate:modelValue":a[5]||(a[5]=e=>X.value.type=e),placeholder:"选择主机类型"},{default:u((()=>[(t(!0),r(i,null,b(he.value,(e=>(t(),p(Ae,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(F,{label:"主机描述:",prop:"description"},{default:u((()=>[o(je,{modelValue:X.value.description,"onUpdate:modelValue":a[6]||(a[6]=e=>X.value.description=e),clearable:!0,placeholder:"请输入主机描述"},null,8,["modelValue"])])),_:1}),1===X.value.type?(t(),p(F,{key:0,label:"开启tls:",prop:"enableTls"},{default:u((()=>[o(xe,{modelValue:X.value.enableTls,"onUpdate:modelValue":a[7]||(a[7]=e=>X.value.enableTls=e),"active-color":"#13ce66","inactive-color":"#ff4949",clearable:""},null,8,["modelValue"])])),_:1})):n("",!0),X.value.enableTls&&1===X.value.type?(t(),p(F,{key:1,label:"跳过安全证书检查:",prop:"skipCert"},{default:u((()=>[o(xe,{modelValue:X.value.skipCert,"onUpdate:modelValue":a[8]||(a[8]=e=>X.value.skipCert=e),"active-color":"#13ce66","inactive-color":"#ff4949",clearable:""},null,8,["modelValue"])])),_:1})):n("",!0),1===X.value.type&&X.value.enableTls&&!X.value.skipCert?(t(),p(F,{key:2,label:"CA证书:",prop:"tlsCa"},{default:u((()=>[o(je,{type:"textarea",modelValue:X.value.tlsCa,"onUpdate:modelValue":a[9]||(a[9]=e=>X.value.tlsCa=e),clearable:!0,placeholder:"填写CA证书内容"},null,8,["modelValue"])])),_:1})):n("",!0),1===X.value.type&&X.value.enableTls&&!X.value.skipCert?(t(),p(F,{key:3,label:"TLS Certificate:",prop:"tlsCert"},{default:u((()=>[o(je,{type:"textarea",modelValue:X.value.tlsCert,"onUpdate:modelValue":a[10]||(a[10]=e=>X.value.tlsCert=e),clearable:!0,placeholder:"填写TLS Certificate"},null,8,["modelValue"])])),_:1})):n("",!0),1===X.value.type&&X.value.enableTls&&!X.value.skipCert?(t(),p(F,{key:4,label:"TLS Key:",prop:"tlsKey"},{default:u((()=>[o(je,{type:"textarea",modelValue:X.value.tlsKey,"onUpdate:modelValue":a[11]||(a[11]=e=>X.value.tlsKey=e),clearable:!0,placeholder:"填写TLS Key"},null,8,["modelValue"])])),_:1})):n("",!0),1===X.value.type?(t(),p(F,{key:5,label:"访问地址:",prop:"apiAddress"},{default:u((()=>[o(je,{modelValue:X.value.apiAddress,"onUpdate:modelValue":a[12]||(a[12]=e=>X.value.apiAddress=e),clearable:!0,placeholder:"示例: example.com or 1.1.1.1"},null,8,["modelValue"])])),_:1})):n("",!0),1===X.value.type?(t(),p(F,{key:6,label:"访问端口:",prop:"port"},{default:u((()=>[o(je,{modelValue:X.value.port,"onUpdate:modelValue":a[13]||(a[13]=e=>X.value.port=e),modelModifiers:{number:!0},clearable:!0,placeholder:"请输入docker api访问端口"},null,8,["modelValue"])])),_:1})):n("",!0),0===X.value.type?(t(),p(F,{key:7,label:"socket文件路径:",prop:"port"},{default:u((()=>[o(je,{modelValue:X.value.socketPath,"onUpdate:modelValue":a[14]||(a[14]=e=>X.value.socketPath=e),modelModifiers:{number:!0},clearable:!0,placeholder:"请输入Socket文件路径,示例: /var/run/docker.sock"},null,8,["modelValue"])])),_:1})):n("",!0),o(F,null,{default:u((()=>[o(q,{onClick:a[15]||(a[15]=e=>_e(X.value))},{default:u((()=>a[31]||(a[31]=[d("测试连接")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}});export{N as default};
