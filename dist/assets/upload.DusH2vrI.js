/*! 
 Build based on  
 Time : 1735190558000 */
import{_ as e,a,S as t,o as s,c as i,b as o,e as l,w as n,g as r,t as p,B as c,U as u,cu as m,i as d,dh as g,E as f,k as h,db as v}from"./index.ABWJOL2Q.js";/* empty css                */import{E as y}from"./pagination.BfYt3rvk.js";/* empty css            */import"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              */import{E as j,a as w}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                *//* empty css               */import{_ as b,U as x,g as _,d as k,e as C,i as E}from"./common.CYrLijw_.js";import{C as O}from"./index.C4P4C0XU.js";import{_ as U}from"./warningBar.BzThqhMC.js";import{E as z}from"./index.DglrVZRl.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_initCloneObject.jmqS1x-g.js";import"./upload.-Ej7EZzx.js";import"./progress.KCbgDfe_.js";import"./cloneDeep.BwH6oqGn.js";import"./_baseClone.gl1e0kmI.js";import"./image.CN53lrx2.js";import"./image-viewer.Dd9ZIujV.js";import"./position.DTC6E8em.js";const B=(e,a)=>{var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height);var s=e.toDataURL("image/png"),i=document.createElement("a"),o=new MouseEvent("click");i.download=a||"photo",i.href=s,i.dispatchEvent(o)},t.src=e},S={class:"dycloud-table-box"},I={class:"dycloud-btn-list gap-3"},T=["onClick"],A={class:"dycloud-pagination"},V=e(Object.assign({name:"Upload"},{__name:"upload",setup(e){const V=a("/api"),L=a(""),M=a(""),P=a(1),D=a(0),R=a(10),q=a({}),F=a([]),G=e=>{R.value=e,J()},H=e=>{P.value=e,J()},J=async()=>{const e=await _({page:P.value,pageSize:R.value,...q.value});0===e.code&&(F.value=e.data.list,D.value=e.data.total,P.value=e.data.page,R.value=e.data.pageSize)};J();const K=()=>{m.prompt("格式：文件名|链接或者仅链接。","导入",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"我的图片|https://my-oss.com/my.png\nhttps://my-oss.com/my_1.png",inputPattern:/\S/,inputErrorMessage:"不能为空"}).then((async({value:e})=>{let a=e.split("\n"),t=[];a.forEach((e=>{let a,s,i=e.trim().split("|");if(i.length>1)s=i[0].trim(),a=i[1];else{a=i[0].trim();let e=a.substring(a.lastIndexOf("/")+1);s=e.substring(0,e.lastIndexOf("."))}a&&t.push({name:s,url:a,tag:a.substring(a.lastIndexOf(".")+1),key:g()})}));0===(await E(t)).code&&(d({type:"success",message:"导入成功!"}),await J())})).catch((()=>{d({type:"info",message:"取消导入"})}))};return(e,a)=>{const g=f,_=h,E=j,N=z,Q=w,W=y,X=v;return t((s(),i("div",null,[o("div",S,[l(U,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),o("div",I,[l(b,{"image-common":M.value,onOnSuccess:J},null,8,["image-common"]),l(x,{"image-url":L.value,"file-size":512,"max-w-h":1080,onOnSuccess:J},null,8,["image-url"]),l(g,{type:"primary",icon:"upload",onClick:K},{default:n((()=>a[1]||(a[1]=[r(" 导入URL ")]))),_:1}),l(_,{modelValue:q.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value.keyword=e),class:"w-72",placeholder:"请输入文件名或备注"},null,8,["modelValue"]),l(g,{type:"primary",icon:"search",onClick:J},{default:n((()=>a[2]||(a[2]=[r("查询")]))),_:1})]),l(Q,{data:F.value},{default:n((()=>[l(E,{align:"left",label:"预览",width:"100"},{default:n((e=>[l(O,{"pic-type":"file","pic-src":e.row.url,preview:""},null,8,["pic-src"])])),_:1}),l(E,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:n((e=>[o("div",null,p(c(u)(e.row.UpdatedAt)),1)])),_:1}),l(E,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:n((e=>[o("div",{class:"name",onClick:a=>(async e=>{m.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await C(e)).code&&(d({type:"success",message:"编辑成功!"}),await J())})).catch((()=>{d({type:"info",message:"取消修改"})}))})(e.row)},p(e.row.name),9,T)])),_:1}),l(E,{align:"left",label:"链接",prop:"url","min-width":"300"}),l(E,{align:"left",label:"标签",prop:"tag",width:"100"},{default:n((e=>[l(N,{type:"jpg"===e.row.tag?"info":"success","disable-transitions":""},{default:n((()=>[r(p(e.row.tag),1)])),_:2},1032,["type"])])),_:1}),l(E,{align:"left",label:"操作",width:"160"},{default:n((e=>[l(g,{icon:"download",type:"primary",link:"",onClick:a=>{var t;(t=e.row).url.indexOf("http://")>-1||t.url.indexOf("https://")>-1?B(t.url,t.name):B(V.value+"/"+t.url,t.name)}},{default:n((()=>a[3]||(a[3]=[r("下载")]))),_:2},1032,["onClick"]),l(g,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{m.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await k(e)).code&&(d({type:"success",message:"删除成功!"}),1===F.value.length&&P.value>1&&P.value--,J())})).catch((()=>{d({type:"info",message:"已取消删除"})}))})(e.row)},{default:n((()=>a[4]||(a[4]=[r("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",A,[l(W,{"current-page":P.value,"page-size":R.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:D.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:H,onSizeChange:G},null,8,["current-page","page-size","total"])])])])),[[X,e.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-060f17aa"]]);export{V as default};
