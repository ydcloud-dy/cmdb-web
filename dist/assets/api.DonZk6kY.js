/*! 
 Build based on  
 Time : 1735190558000 */
import{o as e,h as a,w as l,g as t,i as o,E as i,e as s,_ as u,a as p,c as n,b as r,F as d,v as c,t as m,cu as f,k as v}from"./index.ABWJOL2Q.js";import{E as h}from"./drawer.XhtctEYG.js";import"./overlay.CDLw2uOw.js";import{E as g}from"./pagination.BfYt3rvk.js";/* empty css            */import{E as b,a as y}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               *//* empty css              */import{E as w,a as _}from"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                *//* empty css             *//* empty css               */import{a as x,E as j}from"./form-item.ujPiwBAF.js";import{g as A,i as V,e as k,a as I,d as C,f as E,s as P,b as U,u as G,c as T,h as S}from"./api.CmojoYCN.js";import{t as D}from"./stringFun.hIDu-B3o.js";import{_ as z}from"./warningBar.BzThqhMC.js";import{E as q}from"./upload.-Ej7EZzx.js";import"./progress.KCbgDfe_.js";import"./index.BRjlB3m5.js";import"./index.D4uEcQv3.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./_initCloneObject.jmqS1x-g.js";import"./_baseClone.gl1e0kmI.js";import"./cloneDeep.BwH6oqGn.js";const O={__name:"exportExcel",props:{templateId:{type:String,required:!0},condition:{type:Object,default:()=>({})},limit:{type:Number,default:0},offset:{type:Number,default:0},order:{type:String,default:""}},setup(s){const u=s,p=async()=>{if(""===u.templateId)return void o.error("组件未设置模板ID");const e=JSON.parse(JSON.stringify(u.condition));u.limit&&(e.limit=u.limit),u.offset&&(e.offset=u.offset),u.order&&(e.order=u.order);const a=Object.entries(e).map((([e,a])=>"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(a)))).join("&"),l="".concat("/api","/sysExportTemplate/exportExcel?templateID=").concat(u.templateId).concat(a?"&"+a:"");window.open(l,"_blank")};return(o,s)=>{const u=i;return e(),a(u,{type:"primary",icon:"download",onClick:p},{default:l((()=>s[0]||(s[0]=[t("导出")]))),_:1})}}},B={__name:"exportTemplate",props:{templateId:{type:String,required:!0}},setup(s){const u=s,p=async()=>{if(""===u.templateId)return void o.error("组件未设置模板ID");const e="".concat("/api","/sysExportTemplate/exportTemplate?templateID=").concat(u.templateId);window.open(e,"_blank")};return(o,s)=>{const u=i;return e(),a(u,{type:"primary",icon:"download",onClick:p},{default:l((()=>s[0]||(s[0]=[t("下载模板")]))),_:1})}}},F={__name:"importExcel",props:{templateId:{type:String,required:!0}},emits:["on-success"],setup(u,{emit:p}){const n=u,r=p,d="".concat("/api","/sysExportTemplate/importExcel?templateID=").concat(n.templateId),c=e=>{0===e.code?(o.success("导入成功"),r("on-success")):o.error(e.msg)};return(o,u)=>{const p=i,n=q;return e(),a(n,{action:d,"show-file-list":!1,"on-success":c,multiple:!1},{default:l((()=>[s(p,{type:"primary",icon:"upload",class:"ml-3"},{default:l((()=>u[0]||(u[0]=[t(" 导入 ")]))),_:1})])),_:1})}}},N={class:"dycloud-search-box"},R={class:"dycloud-table-box"},J={class:"dycloud-btn-list"},K={class:"dycloud-pagination"},L={class:"flex justify-between items-center"},M={class:"flex justify-between items-center"},H={class:"text-lg"},Q=u(Object.assign({name:"Api"},{__name:"api",setup(u){const q=e=>{const a=X.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},Q=p([]),W=p({path:"",apiGroup:"",method:"",description:""}),X=p([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),Y=p(""),Z=p({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),$=p(1),ee=p(0),ae=p(10),le=p([]),te=p({}),oe=p([]),ie=p({}),se=async()=>{const e=await A();if(0===e.code){const a=e.data.groups;oe.value=a.map((e=>({label:e,value:e}))),ie.value=e.data.apiGroupMap}},ue=async(e,a)=>{const l=await V({path:e.path,method:e.method,flag:a});if(0===l.code){if(o({type:"success",message:l.msg}),a)return we.value.newApis=we.value.newApis.filter((a=>!(a.path===e.path&&a.method===e.method))),void we.value.ignoreApis.push(e);we.value.ignoreApis=we.value.ignoreApis.filter((a=>!(a.path===e.path&&a.method===e.method))),we.value.newApis.push(e)}},pe=()=>{_e.value=!1},ne=p(!1),re=async()=>{ne.value=!0;const e=await k(we.value);ne.value=!1,0===e.code&&(o({type:"success",message:e.msg}),_e.value=!1,he())},de=()=>{te.value={},he()},ce=()=>{$.value=1,ae.value=10,he()},me=e=>{ae.value=e,he()},fe=e=>{$.value=e,he()},ve=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),te.value.orderKey=D(e),te.value.desc="descending"===a),he()},he=async()=>{const e=await I({page:$.value,pageSize:ae.value,...te.value});0===e.code&&(le.value=e.data.list,ee.value=e.data.total,$.value=e.data.page,ae.value=e.data.pageSize)};he(),se();const ge=e=>{Q.value=e},be=async()=>{f.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=Q.value.map((e=>e.ID)),a=await C({ids:e});0===a.code&&(o({type:"success",message:a.msg}),le.value.length===e.length&&$.value>1&&$.value--,he())}))},ye=async()=>{f.confirm("确定要刷新缓存吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await E();0===e.code&&o({type:"success",message:e.msg})}))},we=p({newApis:[],deleteApis:[],ignoreApis:[]}),_e=p(!1),xe=async()=>{const e=await P();0===e.code&&(e.data.newApis.forEach((e=>{e.apiGroup=ie.value[e.path.split("/")[1]]})),we.value=e.data,_e.value=!0)},je=p(null),Ae=p("新增Api"),Ve=p(!1),ke=e=>{switch(e){case"addApi":Ae.value="新增Api";break;case"edit":Ae.value="编辑Api"}Y.value=e,Ve.value=!0},Ie=()=>{je.value.resetFields(),W.value={path:"",apiGroup:"",method:"",description:""},Ve.value=!1},Ce=async()=>{je.value.validate((async e=>{if(e)switch(Y.value){case"addApi":0===(await T(W.value)).code&&o({type:"success",message:"添加成功",showClose:!0}),he(),se(),Ie();break;case"edit":0===(await G(W.value)).code&&o({type:"success",message:"编辑成功",showClose:!0}),he(),Ie();break;default:o({type:"error",message:"未知操作",showClose:!0})}}))};return(u,p)=>{const A=v,V=x,k=b,I=y,C=i,E=j,P=w,G=_,T=g,D=h;return e(),n("div",null,[r("div",N,[s(E,{ref:"searchForm",inline:!0,model:te.value},{default:l((()=>[s(V,{label:"路径"},{default:l((()=>[s(A,{modelValue:te.value.path,"onUpdate:modelValue":p[0]||(p[0]=e=>te.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),s(V,{label:"描述"},{default:l((()=>[s(A,{modelValue:te.value.description,"onUpdate:modelValue":p[1]||(p[1]=e=>te.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),s(V,{label:"API分组"},{default:l((()=>[s(I,{modelValue:te.value.apiGroup,"onUpdate:modelValue":p[2]||(p[2]=e=>te.value.apiGroup=e),clearable:"",placeholder:"请选择"},{default:l((()=>[(e(!0),n(d,null,c(oe.value,(l=>(e(),a(k,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(V,{label:"请求"},{default:l((()=>[s(I,{modelValue:te.value.method,"onUpdate:modelValue":p[3]||(p[3]=e=>te.value.method=e),clearable:"",placeholder:"请选择"},{default:l((()=>[(e(!0),n(d,null,c(X.value,(l=>(e(),a(k,{key:l.value,label:"".concat(l.label,"(").concat(l.value,")"),value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(V,null,{default:l((()=>[s(C,{type:"primary",icon:"search",onClick:ce},{default:l((()=>p[11]||(p[11]=[t(" 查询 ")]))),_:1}),s(C,{icon:"refresh",onClick:de},{default:l((()=>p[12]||(p[12]=[t(" 重置 ")]))),_:1})])),_:1})])),_:1},8,["model"])]),r("div",R,[r("div",J,[s(C,{type:"primary",icon:"plus",onClick:p[4]||(p[4]=e=>ke("addApi"))},{default:l((()=>p[13]||(p[13]=[t(" 新增 ")]))),_:1}),s(C,{icon:"delete",disabled:!Q.value.length,onClick:be},{default:l((()=>p[14]||(p[14]=[t(" 删除 ")]))),_:1},8,["disabled"]),s(C,{icon:"Refresh",onClick:ye},{default:l((()=>p[15]||(p[15]=[t(" 刷新缓存 ")]))),_:1}),s(C,{icon:"Compass",onClick:xe},{default:l((()=>p[16]||(p[16]=[t(" 同步API ")]))),_:1}),s(B,{"template-id":"api"}),s(O,{"template-id":"api",limit:9999}),s(F,{"template-id":"api",onOnSuccess:he})]),s(G,{data:le.value,onSortChange:ve,onSelectionChange:ge},{default:l((()=>[s(P,{type:"selection",width:"55"}),s(P,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),s(P,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),s(P,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),s(P,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),s(P,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(q(e.row.method)),1)])),_:1}),s(P,{align:"left",fixed:"right",label:"操作",width:"200"},{default:l((e=>[s(C,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await U({id:e.ID});W.value=a.data.api,ke("edit")})(e.row)},{default:l((()=>p[17]||(p[17]=[t(" 编辑 ")]))),_:2},1032,["onClick"]),s(C,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{f.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await S(e)).code&&(o({type:"success",message:"删除成功!"}),1===le.value.length&&$.value>1&&$.value--,he(),se())}))})(e.row)},{default:l((()=>p[18]||(p[18]=[t(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r("div",K,[s(T,{"current-page":$.value,"page-size":ae.value,"page-sizes":[10,30,50,100],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:fe,onSizeChange:me},null,8,["current-page","page-size","total"])])]),s(D,{modelValue:_e.value,"onUpdate:modelValue":p[5]||(p[5]=e=>_e.value=e),size:"80%","before-close":pe,"show-close":!1},{header:l((()=>[r("div",L,[p[21]||(p[21]=r("span",{class:"text-lg"},"同步路由",-1)),r("div",null,[s(C,{onClick:pe},{default:l((()=>p[19]||(p[19]=[t(" 取 消 ")]))),_:1}),s(C,{type:"primary",loading:ne.value,onClick:re},{default:l((()=>p[20]||(p[20]=[t(" 确 定 ")]))),_:1},8,["loading"])])])])),default:l((()=>[s(z,{title:"同步API，不输入路由分组将不会被自动同步"}),p[24]||(p[24]=r("h4",null,[t("新增路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"存在于当前路由中，但是不存在于api表")],-1)),s(G,{data:we.value.newApis},{default:l((()=>[s(P,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(P,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"},{default:l((({row:t})=>[s(I,{modelValue:t.apiGroup,"onUpdate:modelValue":e=>t.apiGroup=e,placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:l((()=>[(e(!0),n(d,null,c(oe.value,(l=>(e(),a(k,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),s(P,{align:"left",label:"API简介","min-width":"150",prop:"description"},{default:l((({row:e})=>[s(A,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,autocomplete:"off"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),s(P,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(q(e.row.method)),1)])),_:1}),s(P,{label:"操作","min-width":"150",fixed:"right"},{default:l((({row:e})=>[s(C,{type:"primary",text:"",onClick:a=>ue(e,!0)},{default:l((()=>p[22]||(p[22]=[t(" 忽略 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),p[25]||(p[25]=r("h4",null,[t("已删除路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"已经不存在于当前项目的路由中，确定同步后会自动从apis表删除")],-1)),s(G,{data:we.value.deleteApis},{default:l((()=>[s(P,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(P,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),s(P,{align:"left",label:"API简介","min-width":"150",prop:"description"}),s(P,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(q(e.row.method)),1)])),_:1})])),_:1},8,["data"]),p[26]||(p[26]=r("h4",null,[t("忽略路由 "),r("span",{class:"text-xs text-gray-500 ml-2 font-normal"},"忽略路由不参与api同步，常见为不需要进行鉴权行为的路由")],-1)),s(G,{data:we.value.ignoreApis},{default:l((()=>[s(P,{align:"left",label:"API路径","min-width":"150",prop:"path"}),s(P,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup"}),s(P,{align:"left",label:"API简介","min-width":"150",prop:"description"}),s(P,{align:"left",label:"请求","min-width":"150",prop:"method"},{default:l((e=>[r("div",null,m(e.row.method)+" / "+m(q(e.row.method)),1)])),_:1}),s(P,{label:"操作","min-width":"150",fixed:"right"},{default:l((({row:e})=>[s(C,{type:"primary",text:"",onClick:a=>ue(e,!1)},{default:l((()=>p[23]||(p[23]=[t(" 取消忽略 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue"]),s(D,{modelValue:Ve.value,"onUpdate:modelValue":p[10]||(p[10]=e=>Ve.value=e),size:"60%","before-close":Ie,"show-close":!1},{header:l((()=>[r("div",M,[r("span",H,m(Ae.value),1),r("div",null,[s(C,{onClick:Ie},{default:l((()=>p[27]||(p[27]=[t(" 取 消 ")]))),_:1}),s(C,{type:"primary",onClick:Ce},{default:l((()=>p[28]||(p[28]=[t(" 确 定 ")]))),_:1})])])])),default:l((()=>[s(z,{title:"新增API，需要在角色管理内配置权限才可使用"}),s(E,{ref_key:"apiForm",ref:je,model:W.value,rules:Z.value,"label-width":"80px"},{default:l((()=>[s(V,{label:"路径",prop:"path"},{default:l((()=>[s(A,{modelValue:W.value.path,"onUpdate:modelValue":p[6]||(p[6]=e=>W.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),s(V,{label:"请求",prop:"method"},{default:l((()=>[s(I,{modelValue:W.value.method,"onUpdate:modelValue":p[7]||(p[7]=e=>W.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:l((()=>[(e(!0),n(d,null,c(X.value,(l=>(e(),a(k,{key:l.value,label:"".concat(l.label,"(").concat(l.value,")"),value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(V,{label:"api分组",prop:"apiGroup"},{default:l((()=>[s(I,{modelValue:W.value.apiGroup,"onUpdate:modelValue":p[8]||(p[8]=e=>W.value.apiGroup=e),placeholder:"请选择或新增","allow-create":"",filterable:"","default-first-option":""},{default:l((()=>[(e(!0),n(d,null,c(oe.value,(l=>(e(),a(k,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(V,{label:"api简介",prop:"description"},{default:l((()=>[s(A,{modelValue:W.value.description,"onUpdate:modelValue":p[9]||(p[9]=e=>W.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-38d1fe5e"]]);export{Q as default};
