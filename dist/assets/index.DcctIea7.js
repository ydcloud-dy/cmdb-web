/*! 
 Build based on  
 Time : 1735190558000 */
import{a as e,o as a,c as l,b as s,e as t,w as o,g as u,f as r,F as i,v as n,h as m,i as p,k as d,E as c}from"./index.ABWJOL2Q.js";/* empty css            */import{E as v,a as g}from"./select.C2tLDQ30.js";import"./scrollbar.3ySweVnY.js";/* empty css               */import{E as j}from"./dialog.DdLHJsLF.js";import"./overlay.CDLw2uOw.js";import{E as y}from"./pagination.BfYt3rvk.js";/* empty css              *//* empty css             *//* empty css               */import{a as f,E as b}from"./form-item.ujPiwBAF.js";import{c as _,u as h}from"./applications.GrMV9Sfs.js";import k from"./form.Cnndfo6X.js";import w from"./table.C_2fy01I.js";import{s as x}from"./cloud_region.DtcSymib.js";import{S as V,e as C,R as z,f as U,h as E}from"./pipelines.B5fOuFXJ.js";import"./index.D4uEcQv3.js";import"./index.BRjlB3m5.js";import"./index.DglrVZRl.js";import"./token.DWNpOE8r.js";import"./strings.C2tuonvC.js";import"./castArray.9wqFpW2Z.js";import"./isEqual.CtpQH3Dm.js";import"./_Uint8Array.BjvNwsUf.js";import"./debounce.CkdGDwJt.js";import"./_baseIteratee.BPaQBmlP.js";import"./index.6ock-Gvr.js";import"./refs.CZv2DkwS.js";import"./_baseClone.gl1e0kmI.js";import"./_initCloneObject.jmqS1x-g.js";import"./codeSource.zRy1fTFq.js";import"./buildEnv.vyGXBGni.js";import"./table-column.ChuwY-lb.js";import"./checkbox.BcMUmSPv.js";/* empty css                */import"./popover.DFR01WU1.js";import"./dropdown.Co_mIot6.js";import"./link.QK3LjIND.js";import"./dayjs.min.DOWqlKAh.js";import"./stringFun.hIDu-B3o.js";const S={class:"dycloud-search-box"},I={class:"dycloud-table-box"},O={class:"dycloud-btn-list"},T={key:0},D={class:"dycloud-pagination"},F={key:0},A={name:"Index"},R=Object.assign(A,{setup(A){const R=e(1),q=e(0),B=e(10),G=e([]),H=e(""),J=e({});e(!1);const L=e([]),M=e([]),N=e(!1),W=e({repoUrl:"https://github.com/ydcloud-dy/spring-boot-helloWorld.git",branchOrTag:"main"}),K=e(["develop","main","test","test_1","test_2","test_3"]),P=async()=>{try{const e=await V(oe.value.ID);e&&0===e.code?(Q(),p.success("分支同步成功")):p.success("分支刷新失败:",e.msg)}catch(e){}},Q=async()=>{try{const e=await C(oe.value.ID);e&&e.data&&e.data.list?K.value=e.data.list.map((e=>e.branch_name)):K.value=[]}catch(e){}},X=async()=>{N.value=!1;const e={name:oe.value.name||"",k8s_namespace:oe.value.k8s_namespace||"default",app_name:oe.value.app_name,env_name:oe.value.env_name,k8s_cluster_name:oe.value.k8s_cluster_name,git_branch:W.value.branchOrTag};let a;a=await z(e),a&&0===a.code?p.success("流水线已运行"):p({type:"error",message:a?a.msg:"操作失败"})},Y=()=>{J.value={}},Z=e=>{J.value=e,le()},$=()=>{R.value=1,B.value=10,le()},ee=e=>{B.value=e,le()},ae=e=>{R.value=e,le()},le=async()=>{const e=await U({page:R.value,pageSize:B.value,keyword:J.value.name});0===e.code&&(G.value=e.data.list,q.value=e.data.total,R.value=e.data.page,B.value=e.data.pageSize)};le();const se=e(!1),te=e(""),oe=e(),ue=async e=>{N.value=!0,oe.value=e,Q(),W.value.repoUrl=e.git_url},re=async e=>{0===(await x({id:e.id})).code&&(p({type:"success",message:"操作成功"}),le())},ie=()=>{se.value=!1,W.value={}},ne=async e=>{e.visible=!1;0===(await E(e.ID)).code&&(p({type:"success",message:"删除成功"}),1===G.value.length&&R.value>1&&R.value--,le())},me=e=>{L.value=e},pe=async e=>{let a;"create"===te.value?a=await _(e):"update"===te.value&&(a=await h(e)),a&&0===a.code?(ie(),(async e=>{0===e.code&&(p({type:"success",message:e.msg}),1===G.value.length&&R.value>1&&R.value--,le())})(a)):p({type:"error",message:a?a.msg:"操作失败"})},de=async e=>{const a=await TestService(e);0===a.code&&p({type:"success",message:a.data})};return(e,p)=>{const _=d,h=f,x=c,V=b,C=y,z=j,U=v,E=g;return a(),l("div",null,[s("div",S,[t(V,{ref:"searchForm",inline:!0,model:J.value},{default:o((()=>[t(h,{label:"名称"},{default:o((()=>[t(_,{modelValue:J.value.name,"onUpdate:modelValue":p[0]||(p[0]=e=>J.value.name=e),placeholder:"名称"},null,8,["modelValue"])])),_:1}),t(h,null,{default:o((()=>[t(x,{size:"small",type:"primary",icon:"search",onClick:$},{default:o((()=>p[7]||(p[7]=[u("查询")]))),_:1}),t(x,{size:"small",icon:"refresh",onClick:Y},{default:o((()=>p[8]||(p[8]=[u("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),s("div",I,[s("div",O,[t(x,{size:"small",type:"primary",icon:"plus",onClick:p[1]||(p[1]=e=>(te.value="create",H.value="创建",void(se.value=!0)))},{default:o((()=>p[9]||(p[9]=[u("新增")]))),_:1})]),G.value?(a(),l("div",T,[t(w,{"table-data":G.value,onRun:ue,onSearch:Z,onTest:de,onSelect:me,onDelete:ne,onRegion:re},null,8,["table-data"])])):r("",!0)]),s("div",D,[t(C,{"current-page":R.value,"page-size":B.value,"page-sizes":[10,30,50,100],total:q.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ae,onSizeChange:ee},null,8,["current-page","page-size","total"])]),se.value?(a(),l("div",F,[t(z,{modelValue:se.value,"onUpdate:modelValue":p[2]||(p[2]=e=>se.value=e),width:"40%",title:H.value,"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{default:o((()=>[t(k,{form:W.value,regions:M.value,onClose:ie,type:te.value,onEnter:pe},null,8,["form","regions","type"])])),_:1},8,["modelValue","title"])])):r("",!0),t(z,{modelValue:N.value,"onUpdate:modelValue":p[6]||(p[6]=e=>N.value=e),width:"50%",title:"运行流水线"},{footer:o((()=>[t(x,{onClick:p[5]||(p[5]=e=>N.value=!1)},{default:o((()=>p[11]||(p[11]=[u("取消")]))),_:1}),t(x,{type:"primary",onClick:X},{default:o((()=>p[12]||(p[12]=[u("运行")]))),_:1})])),default:o((()=>[s("div",null,[t(V,{model:W.value},{default:o((()=>[t(h,{label:"仓库地址：","label-width":"100px"},{default:o((()=>[t(_,{modelValue:W.value.repoUrl,"onUpdate:modelValue":p[3]||(p[3]=e=>W.value.repoUrl=e),readonly:"",disabled:""},null,8,["modelValue"])])),_:1}),t(h,{label:"分支：","label-width":"100px"},{default:o((()=>[t(E,{modelValue:W.value.branchOrTag,"onUpdate:modelValue":p[4]||(p[4]=e=>W.value.branchOrTag=e),placeholder:"请选择"},{default:o((()=>[(a(!0),l(i,null,n(K.value,(e=>(a(),m(U,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),t(x,{type:"text",onClick:P},{default:o((()=>p[10]||(p[10]=[u("刷新")]))),_:1})])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"])])}}});export{R as default};
